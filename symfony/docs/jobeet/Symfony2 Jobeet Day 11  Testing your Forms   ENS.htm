<!DOCTYPE html>
<!-- saved from url=(0071)http://www.ens.ro/2012/06/22/symfony2-jobeet-day-11-testing-your-forms/ -->
<html lang="en-US" xmlns:og="http://opengraphprotocol.org/schema/" xmlns:fb="http://www.facebook.com/2008/fbml"><!--<![endif]--><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><script type="text/javascript" async="" src="./Symfony2 Jobeet Day 11  Testing your Forms   ENS_files/plusone.js" gapi_processed="true"></script>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<title>Symfony2 Jobeet Day 11: Testing your Forms | ENS</title>
<link rel="profile" href="http://gmpg.org/xfn/11">
<link rel="stylesheet" type="text/css" media="all" href="./Symfony2 Jobeet Day 11  Testing your Forms   ENS_files/style.css">
<link rel="pingback" href="http://www.ens.ro/xmlrpc.php">
<!--[if lt IE 9]>
<script src="http://www.ens.ro/wp-content/themes/twentyeleven/js/html5.js" type="text/javascript"></script>
<![endif]-->

	<link rel="stylesheet" href="./Symfony2 Jobeet Day 11  Testing your Forms   ENS_files/dcssb.css" type="text/css" media="screen">
	<!--Facebook OpenGraph Slick Social Share Buttons -->
	<meta property="og:site_name" content="ENS">
		<meta property="og:title" content="Symfony2 Jobeet Day 11: Testing your Forms">
			<meta property="og:description" content="In day 10, we created our first form with Symfony2. People are now able to post a new job on Jobeet but we ran out of time before we could add some tests. That&#39;s what we will do along these lines.
Su">
		
		<meta property="og:url" content="http://www.ens.ro/2012/06/22/symfony2-jobeet-day-11-testing-your-forms/">
		
		<meta property="og:image" content="">
		<meta property="fb:admins" content="533936499">
		<meta property="fb:app_id" content="">
		<meta property="og:type" content="article"><!--End Facebook OpenGraph Settings -->
		<link rel="alternate" type="application/rss+xml" title="ENS » Feed" href="http://www.ens.ro/feed/">
<link rel="alternate" type="application/rss+xml" title="ENS » Comments Feed" href="http://www.ens.ro/comments/feed/">

			<script src="./Symfony2 Jobeet Day 11  Testing your Forms   ENS_files/cb=gapi.loaded_1" async=""></script><script src="./Symfony2 Jobeet Day 11  Testing your Forms   ENS_files/cb=gapi.loaded_0" async=""></script><script type="text/javascript" async="" src="./Symfony2 Jobeet Day 11  Testing your Forms   ENS_files/plusone.js" gapi_processed="true"></script><script type="text/javascript" async="" src="./Symfony2 Jobeet Day 11  Testing your Forms   ENS_files/ga.js"></script><script type="text/javascript">//<![CDATA[
			// Google Analytics for WordPress by Yoast v4.2.8 | http://yoast.com/wordpress/google-analytics/
			var _gaq = _gaq || [];
			_gaq.push(['_setAccount', 'UA-29990339-1']);
							_gaq.push(['_trackPageview']);
			(function () {
				var ga = document.createElement('script');
				ga.type = 'text/javascript';
				ga.async = true;
				ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
				var s = document.getElementsByTagName('script')[0];
				s.parentNode.insertBefore(ga, s);
			})();
			//]]></script>
			<link rel="alternate" type="application/rss+xml" title="ENS » Symfony2 Jobeet Day 11: Testing your Forms Comments Feed" href="http://www.ens.ro/2012/06/22/symfony2-jobeet-day-11-testing-your-forms/feed/">
<link rel="stylesheet" id="contact-form-7-css" href="./Symfony2 Jobeet Day 11  Testing your Forms   ENS_files/styles.css" type="text/css" media="all">
<link rel="stylesheet" id="NextGEN-css" href="./Symfony2 Jobeet Day 11  Testing your Forms   ENS_files/nggallery.css" type="text/css" media="screen">
<link rel="stylesheet" id="shutter-css" href="./Symfony2 Jobeet Day 11  Testing your Forms   ENS_files/shutter-reloaded.css" type="text/css" media="screen">
<script type="text/javascript" src="./Symfony2 Jobeet Day 11  Testing your Forms   ENS_files/comment-reply.min.js"></script>
<script type="text/javascript" src="./Symfony2 Jobeet Day 11  Testing your Forms   ENS_files/jquery.js"></script>
<script type="text/javascript" src="./Symfony2 Jobeet Day 11  Testing your Forms   ENS_files/ga.social_tracking.js"></script>
<script type="text/javascript" src="./Symfony2 Jobeet Day 11  Testing your Forms   ENS_files/jquery.social.slick.1.0.js"></script>
<script type="text/javascript">
/* <![CDATA[ */
var shutterSettings = {"msgLoading":"L O A D I N G","msgClose":"Click to Close","imageCount":"1"};
/* ]]> */
</script>
<script type="text/javascript" src="./Symfony2 Jobeet Day 11  Testing your Forms   ENS_files/shutter-reloaded.js"></script>
<script type="text/javascript" src="./Symfony2 Jobeet Day 11  Testing your Forms   ENS_files/jquery.cycle.all.min.js"></script>
<script type="text/javascript" src="./Symfony2 Jobeet Day 11  Testing your Forms   ENS_files/ngg.slideshow.min.js"></script>
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="http://www.ens.ro/xmlrpc.php?rsd">
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="http://www.ens.ro/wp-includes/wlwmanifest.xml"> 
<link rel="prev" title="Set up Symfony2 app/cache and app/logs permissions on Ubuntu" href="http://www.ens.ro/2012/06/20/set-up-symfony2-appcache-and-applogs-permissions-on-ubuntu/">
<link rel="next" title="Symfony2 Doctrine force entity ID on persist" href="http://www.ens.ro/2012/07/03/symfony2-doctrine-force-entity-id-on-persist/">
<meta name="generator" content="WordPress 3.5">
<link rel="canonical" href="./Symfony2 Jobeet Day 11  Testing your Forms   ENS_files/Symfony2 Jobeet Day 11  Testing your Forms   ENS.htm">
<link rel="shortlink" href="http://www.ens.ro/?p=1561">
<!-- <meta name="NextGEN" version="1.9.10" /> -->
	<style type="text/css">.recentcomments a{display:inline !important;padding:0 !important;margin:0 !important;}</style>
<style type="text/css" id="custom-background-css">
body.custom-background { background-color: #f1f1f1; background-image: url('http://www.ens.ro/wp-content/uploads/2012/08/bgbody1.gif'); background-repeat: repeat; background-position: top left; background-attachment: fixed; }
</style>
<link rel="stylesheet" type="text/css" href="./Symfony2 Jobeet Day 11  Testing your Forms   ENS_files/shCore.css"><link rel="stylesheet" type="text/css" href="./Symfony2 Jobeet Day 11  Testing your Forms   ENS_files/shThemeDefault.css"><meta id="syntaxhighlighteranchor" name="syntaxhighlighter-version" content="3.1.3">
<style type="text/css">.fb_hidden{position:absolute;top:-10000px;z-index:10001}
.fb_invisible{display:none}
.fb_reset{background:none;border:0;border-spacing:0;color:#000;cursor:auto;direction:ltr;font-family:"lucida grande", tahoma, verdana, arial, sans-serif;font-size:11px;font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:normal;line-height:1;margin:0;overflow:visible;padding:0;text-align:left;text-decoration:none;text-indent:0;text-shadow:none;text-transform:none;visibility:visible;white-space:normal;word-spacing:normal}
.fb_reset > div{overflow:hidden}
.fb_link img{border:none}
.fb_dialog{background:rgba(82, 82, 82, .7);position:absolute;top:-10000px;z-index:10001}
.fb_dialog_advanced{padding:10px;-moz-border-radius:8px;-webkit-border-radius:8px;border-radius:8px}
.fb_dialog_content{background:#fff;color:#333}
.fb_dialog_close_icon{background:url(http://static.ak.fbcdn.net/rsrc.php/v2/yq/r/IE9JII6Z1Ys.png) no-repeat scroll 0 0 transparent;_background-image:url(http://static.ak.fbcdn.net/rsrc.php/v2/yL/r/s816eWC-2sl.gif);cursor:pointer;display:block;height:15px;position:absolute;right:18px;top:17px;width:15px;top:8px\9;right:7px\9}
.fb_dialog_mobile .fb_dialog_close_icon{top:5px;left:5px;right:auto}
.fb_dialog_padding{background-color:transparent;position:absolute;width:1px;z-index:-1}
.fb_dialog_close_icon:hover{background:url(http://static.ak.fbcdn.net/rsrc.php/v2/yq/r/IE9JII6Z1Ys.png) no-repeat scroll 0 -15px transparent;_background-image:url(http://static.ak.fbcdn.net/rsrc.php/v2/yL/r/s816eWC-2sl.gif)}
.fb_dialog_close_icon:active{background:url(http://static.ak.fbcdn.net/rsrc.php/v2/yq/r/IE9JII6Z1Ys.png) no-repeat scroll 0 -30px transparent;_background-image:url(http://static.ak.fbcdn.net/rsrc.php/v2/yL/r/s816eWC-2sl.gif)}
.fb_dialog_loader{background-color:#f2f2f2;border:1px solid #606060;font-size:24px;padding:20px}
.fb_dialog_top_left,
.fb_dialog_top_right,
.fb_dialog_bottom_left,
.fb_dialog_bottom_right{height:10px;width:10px;overflow:hidden;position:absolute}
.fb_dialog_top_left{background:url(http://static.ak.fbcdn.net/rsrc.php/v2/ye/r/8YeTNIlTZjm.png) no-repeat 0 0;left:-10px;top:-10px}
.fb_dialog_top_right{background:url(http://static.ak.fbcdn.net/rsrc.php/v2/ye/r/8YeTNIlTZjm.png) no-repeat 0 -10px;right:-10px;top:-10px}
.fb_dialog_bottom_left{background:url(http://static.ak.fbcdn.net/rsrc.php/v2/ye/r/8YeTNIlTZjm.png) no-repeat 0 -20px;bottom:-10px;left:-10px}
.fb_dialog_bottom_right{background:url(http://static.ak.fbcdn.net/rsrc.php/v2/ye/r/8YeTNIlTZjm.png) no-repeat 0 -30px;right:-10px;bottom:-10px}
.fb_dialog_vert_left,
.fb_dialog_vert_right,
.fb_dialog_horiz_top,
.fb_dialog_horiz_bottom{position:absolute;background:#525252;filter:alpha(opacity=70);opacity:.7}
.fb_dialog_vert_left,
.fb_dialog_vert_right{width:10px;height:100%}
.fb_dialog_vert_left{margin-left:-10px}
.fb_dialog_vert_right{right:0;margin-right:-10px}
.fb_dialog_horiz_top,
.fb_dialog_horiz_bottom{width:100%;height:10px}
.fb_dialog_horiz_top{margin-top:-10px}
.fb_dialog_horiz_bottom{bottom:0;margin-bottom:-10px}
.fb_dialog_iframe{line-height:0}
.fb_dialog_content .dialog_title{background:#6d84b4;border:1px solid #3b5998;color:#fff;font-size:14px;font-weight:bold;margin:0}
.fb_dialog_content .dialog_title > span{background:url(http://static.ak.fbcdn.net/rsrc.php/v2/yd/r/Cou7n-nqK52.gif)
no-repeat 5px 50%;float:left;padding:5px 0 7px 26px}
body.fb_hidden{-webkit-transform:none;height:100%;margin:0;overflow:visible;position:absolute;top:-10000px;left:0;width:100%}
.fb_dialog.fb_dialog_mobile.loading{background:url(http://static.ak.fbcdn.net/rsrc.php/v2/ya/r/3rhSv5V8j3o.gif)
white no-repeat 50% 50%;min-height:100%;min-width:100%;overflow:hidden;position:absolute;top:0;z-index:10001}
.fb_dialog.fb_dialog_mobile.loading.centered{max-height:590px;min-height:590px;max-width:500px;min-width:500px}
#fb-root #fb_dialog_ipad_overlay{background:rgba(0, 0, 0, .45);position:absolute;left:0;top:0;width:100%;min-height:100%;z-index:10000}
#fb-root #fb_dialog_ipad_overlay.hidden{display:none}
.fb_dialog.fb_dialog_mobile.loading iframe{visibility:hidden}
.fb_dialog_content .dialog_header{-webkit-box-shadow:white 0 1px 1px -1px inset;background:-webkit-gradient(linear, 0% 0%, 0% 100%, from(#738ABA), to(#2C4987));border-bottom:1px solid;border-color:#1d4088;color:#fff;font:14px Helvetica, sans-serif;font-weight:bold;text-overflow:ellipsis;text-shadow:rgba(0, 30, 84, .296875) 0 -1px 0;vertical-align:middle;white-space:nowrap}
.fb_dialog_content .dialog_header table{-webkit-font-smoothing:subpixel-antialiased;height:43px;width:100%
}
.fb_dialog_content .dialog_header td.header_left{font-size:12px;padding-left:5px;vertical-align:middle;width:60px
}
.fb_dialog_content .dialog_header td.header_right{font-size:12px;padding-right:5px;vertical-align:middle;width:60px
}
.fb_dialog_content .touchable_button{background:-webkit-gradient(linear, 0% 0%, 0% 100%, from(#4966A6),
color-stop(0.5, #355492), to(#2A4887));border:1px solid #29447e;-webkit-background-clip:padding-box;-webkit-border-radius:3px;-webkit-box-shadow:rgba(0, 0, 0, .117188) 0 1px 1px inset,
rgba(255, 255, 255, .167969) 0 1px 0;display:inline-block;margin-top:3px;max-width:85px;line-height:18px;padding:4px 12px;position:relative}
.fb_dialog_content .dialog_header .touchable_button input{border:none;background:none;color:#fff;font:12px Helvetica, sans-serif;font-weight:bold;margin:2px -12px;padding:2px 6px 3px 6px;text-shadow:rgba(0, 30, 84, .296875) 0 -1px 0}
.fb_dialog_content .dialog_header .header_center{color:#fff;font-size:16px;font-weight:bold;line-height:18px;text-align:center;vertical-align:middle}
.fb_dialog_content .dialog_content{background:url(http://static.ak.fbcdn.net/rsrc.php/v2/y9/r/jKEcVPZFk-2.gif) no-repeat 50% 50%;border:1px solid #555;border-bottom:0;border-top:0;height:150px}
.fb_dialog_content .dialog_footer{background:#f2f2f2;border:1px solid #555;border-top-color:#ccc;height:40px}
#fb_dialog_loader_close{float:left}
.fb_dialog.fb_dialog_mobile .fb_dialog_close_button{text-shadow:rgba(0, 30, 84, .296875) 0 -1px 0}
.fb_dialog.fb_dialog_mobile .fb_dialog_close_icon{visibility:hidden}
.fb_iframe_widget{display:inline-block;position:relative}
.fb_iframe_widget span{display:inline-block;position:relative;text-align:justify}
.fb_iframe_widget iframe{position:absolute}
.fb_iframe_widget_lift{z-index:1}
.fb_hide_iframes iframe{position:relative;left:-10000px}
.fb_iframe_widget_loader{position:relative;display:inline-block}
.fb_iframe_widget_fluid{display:inline}
.fb_iframe_widget_fluid span{width:100%}
.fb_iframe_widget_loader iframe{min-height:32px;z-index:2;zoom:1}
.fb_iframe_widget_loader .FB_Loader{background:url(http://static.ak.fbcdn.net/rsrc.php/v2/y9/r/jKEcVPZFk-2.gif) no-repeat;height:32px;width:32px;margin-left:-16px;position:absolute;left:50%;z-index:4}
.fb_connect_bar_container div,
.fb_connect_bar_container span,
.fb_connect_bar_container a,
.fb_connect_bar_container img,
.fb_connect_bar_container strong{background:none;border-spacing:0;border:0;direction:ltr;font-style:normal;font-variant:normal;letter-spacing:normal;line-height:1;margin:0;overflow:visible;padding:0;text-align:left;text-decoration:none;text-indent:0;text-shadow:none;text-transform:none;visibility:visible;white-space:normal;word-spacing:normal;vertical-align:baseline}
.fb_connect_bar_container{position:fixed;left:0 !important;right:0 !important;height:42px !important;padding:0 25px !important;margin:0 !important;vertical-align:middle !important;border-bottom:1px solid #333 !important;background:#3b5998 !important;z-index:99999999 !important;overflow:hidden !important}
.fb_connect_bar_container_ie6{position:absolute;top:expression(document.compatMode=="CSS1Compat"? document.documentElement.scrollTop+"px":body.scrollTop+"px")}
.fb_connect_bar{position:relative;margin:auto;height:100%;width:100%;padding:6px 0 0 0 !important;background:none;color:#fff !important;font-family:"lucida grande", tahoma, verdana, arial, sans-serif !important;font-size:13px !important;font-style:normal !important;font-variant:normal !important;font-weight:normal !important;letter-spacing:normal !important;line-height:1 !important;text-decoration:none !important;text-indent:0 !important;text-shadow:none !important;text-transform:none !important;white-space:normal !important;word-spacing:normal !important}
.fb_connect_bar a:hover{color:#fff}
.fb_connect_bar .fb_profile img{height:30px;width:30px;vertical-align:middle;margin:0 6px 5px 0}
.fb_connect_bar div a,
.fb_connect_bar span,
.fb_connect_bar span a{color:#bac6da;font-size:11px;text-decoration:none}
.fb_connect_bar .fb_buttons{float:right;margin-top:7px}
.fb_edge_widget_with_comment{position:relative;*z-index:1000}
.fb_edge_widget_with_comment span.fb_edge_comment_widget{position:absolute}
.fb_edge_widget_with_comment span.fb_send_button_form_widget{z-index:1}
.fb_edge_widget_with_comment span.fb_send_button_form_widget .FB_Loader{left:0;top:1px;margin-top:6px;margin-left:0;background-position:50% 50%;background-color:#fff;height:150px;width:394px;border:1px #666 solid;border-bottom:2px solid #283e6c;z-index:1}
.fb_edge_widget_with_comment span.fb_send_button_form_widget.dark .FB_Loader{background-color:#000;border-bottom:2px solid #ccc}
.fb_edge_widget_with_comment span.fb_send_button_form_widget.siderender
.FB_Loader{margin-top:0}
.fbpluginrecommendationsbarleft,
.fbpluginrecommendationsbarright{position:fixed !important;bottom:0;z-index:999}
.fbpluginrecommendationsbarleft{left:10px}
.fbpluginrecommendationsbarright{right:10px}</style></head>

<body class="single single-post postid-1561 single-format-standard custom-background single-author singular two-column right-sidebar" data-twttr-rendered="true">
<div id="page" class="hfeed">
	<header id="branding" role="banner">
			<hgroup>
				<h1 id="site-title"><span><a href="http://www.ens.ro/" title="ENS" rel="home">ENS</a></span></h1>
				<h2 id="site-description">Entertainment, News, Software</h2>
			</hgroup>

						<a href="http://www.ens.ro/">
									<img src="./Symfony2 Jobeet Day 11  Testing your Forms   ENS_files/cropped-wallpaper-15057031.jpg" width="1000" height="288" alt="">
							</a>
			
								<form method="get" id="searchform" action="http://www.ens.ro/">
		<label for="s" class="assistive-text">Search</label>
		<input type="text" class="field" name="s" id="s" placeholder="Search">
		<input type="submit" class="submit" name="submit" id="searchsubmit" value="Search">
	</form>
			
			<nav id="access" role="navigation">
				<h3 class="assistive-text">Main menu</h3>
								<div class="skip-link"><a class="assistive-text" href="http://www.ens.ro/2012/06/22/symfony2-jobeet-day-11-testing-your-forms/#content" title="Skip to primary content">Skip to primary content</a></div>
				<div class="skip-link"><a class="assistive-text" href="http://www.ens.ro/2012/06/22/symfony2-jobeet-day-11-testing-your-forms/#secondary" title="Skip to secondary content">Skip to secondary content</a></div>
								<div class="menu-my-menu-container"><ul id="menu-my-menu" class="menu"><li id="menu-item-161" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-161"><a href="http://www.ens.ro/">Home</a></li>
<li id="menu-item-160" class="menu-item menu-item-type-taxonomy menu-item-object-category current-post-ancestor current-menu-parent current-post-parent menu-item-160"><a href="http://www.ens.ro/category/web-development/">Web Development</a>
<ul class="sub-menu">
	<li id="menu-item-822" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-822"><a title="The Jobeet Tutorial with Symfony2" href="http://www.ens.ro/tag/symfony2-jobeet/">Symfony2 Jobeet</a></li>
	<li id="menu-item-2050" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-2050"><a title="Symfony2 Tutorials" href="http://www.ens.ro/tag/symfony2/">Symfony2</a></li>
	<li id="menu-item-2055" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-2055"><a title="Symfony 1.4 Tutorials" href="http://www.ens.ro/tag/symfony-1-4/">Symfony 1.4</a></li>
	<li id="menu-item-2049" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-2049"><a title="Zend Framework Tutorials" href="http://www.ens.ro/tag/zend/">Zend</a></li>
	<li id="menu-item-2063" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-2063"><a title="PHP Tutorials" href="http://www.ens.ro/tag/php-2/">PHP</a></li>
	<li id="menu-item-2064" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-2064"><a title="MySQL Tutorials" href="http://www.ens.ro/tag/mysql/">MySQL</a></li>
</ul>
</li>
<li id="menu-item-2073" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-2073"><a title="Entertainment" href="http://www.ens.ro/tag/entertainment/">Entertainment</a></li>
<li id="menu-item-159" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-159"><a href="http://www.ens.ro/about/">About ENS</a></li>
<li id="menu-item-1267" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-1267"><a href="http://www.ens.ro/contact/">Contact</a></li>
</ul></div>			</nav><!-- #access -->
	</header><!-- #branding -->


	<div id="main">

		<div id="primary">
			<div id="content" role="main">

				
					<nav id="nav-single">
						<h3 class="assistive-text">Post navigation</h3>
						<span class="nav-previous"><a href="http://www.ens.ro/2012/06/20/set-up-symfony2-appcache-and-applogs-permissions-on-ubuntu/" rel="prev"><span class="meta-nav">←</span> Previous</a></span>
						<span class="nav-next"><a href="http://www.ens.ro/2012/07/03/symfony2-doctrine-force-entity-id-on-persist/" rel="next">Next <span class="meta-nav">→</span></a></span>
					</nav><!-- #nav-single -->

					
<article id="post-1561" class="post-1561 post type-post status-publish format-standard hentry category-english category-php category-web-development tag-symfony2-jobeet">
	<header class="entry-header">
		<h1 class="entry-title">Symfony2 Jobeet Day 11: Testing your Forms</h1>

				<div class="entry-meta">
			<span class="sep">Posted on </span><a href="./Symfony2 Jobeet Day 11  Testing your Forms   ENS_files/Symfony2 Jobeet Day 11  Testing your Forms   ENS.htm" title="9:23 am" rel="bookmark"><time class="entry-date" datetime="2012-06-22T09:23:20+00:00">June 22, 2012</time></a><span class="by-author"> <span class="sep"> by </span> <span class="author vcard"><a class="url fn n" href="http://www.ens.ro/author/dragos/" title="View all posts by Dragos Holban" rel="author">Dragos Holban</a></span></span>		</div><!-- .entry-meta -->
			</header><!-- .entry-header -->

	<div class="entry-content">
		<p>In day 10, we created our first form with Symfony2. People are now able to post a new job on Jobeet but we ran out of time before we could add some tests. That’s what we will do along these lines.<span id="more-1561"></span></p>
<h2>Submitting a Form</h2>
<p>Let’s open the <code>JobControllerTest</code> file to add functional tests for the job creation and validation process. At the end of the file, add the following code to get the job creation page:</p>
<div><div id="highlighter_103179" class="syntaxhighlighter  php"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="php comments">// src/Ens/JobeetBundle/Tests/Controller/JobControllerTest.php</code></div><div class="line number2 index1 alt1"><code class="php comments">// ...</code></div><div class="line number3 index2 alt2">&nbsp;</div><div class="line number4 index3 alt1"><code class="php keyword">public</code> <code class="php keyword">function</code> <code class="php plain">testJobForm()</code></div><div class="line number5 index4 alt2"><code class="php plain">{</code></div><div class="line number6 index5 alt1"><code class="php spaces">&nbsp;&nbsp;</code><code class="php variable">$client</code> <code class="php plain">= </code><code class="php keyword">static</code><code class="php plain">::createClient();</code></div><div class="line number7 index6 alt2">&nbsp;</div><div class="line number8 index7 alt1"><code class="php spaces">&nbsp;&nbsp;</code><code class="php variable">$crawler</code> <code class="php plain">= </code><code class="php variable">$client</code><code class="php plain">-&gt;request(</code><code class="php string">'GET'</code><code class="php plain">, </code><code class="php string">'/job/new'</code><code class="php plain">);</code></div><div class="line number9 index8 alt2"><code class="php spaces">&nbsp;&nbsp;</code><code class="php variable">$this</code><code class="php plain">-&gt;assertEquals(</code><code class="php string">'Ens\JobeetBundle\Controller\JobController::newAction'</code><code class="php plain">, </code><code class="php variable">$client</code><code class="php plain">-&gt;getRequest()-&gt;attributes-&gt;get(</code><code class="php string">'_controller'</code><code class="php plain">));</code></div><div class="line number10 index9 alt1"><code class="php plain">}</code></div></div></td></tr></tbody></table></div></div>
<p>To select forms we will use the <code>selectButton()</code> method. This method can select <code>button</code> tags and submit <code>input</code> tags. Once you have a Crawler representing a button, call the <code>form()</code> method to get a <code>Form</code> instance for the form wrapping the button node:</p>
<div><div id="highlighter_515986" class="syntaxhighlighter  php"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="php variable">$form</code> <code class="php plain">= </code><code class="php variable">$crawler</code><code class="php plain">-&gt;selectButton(</code><code class="php string">'submit'</code><code class="php plain">)-&gt;form();</code></div></div></td></tr></tbody></table></div></div>
<p>When calling the <code>form()</code> method, you can also pass an array of field values that overrides the default ones:</p>
<div><div id="highlighter_329994" class="syntaxhighlighter  php"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="php variable">$form</code> <code class="php plain">= </code><code class="php variable">$crawler</code><code class="php plain">-&gt;selectButton(</code><code class="php string">'submit'</code><code class="php plain">)-&gt;form(</code><code class="php keyword">array</code><code class="php plain">(</code></div><div class="line number2 index1 alt1"><code class="php spaces">&nbsp;&nbsp;</code><code class="php string">'name'</code> <code class="php plain">=&gt; </code><code class="php string">'Fabien'</code><code class="php plain">,</code></div><div class="line number3 index2 alt2"><code class="php spaces">&nbsp;&nbsp;</code><code class="php string">'my_form[subject]'</code> <code class="php plain">=&gt; </code><code class="php string">'Symfony Rocks!'</code></div><div class="line number4 index3 alt1"><code class="php plain">));</code></div></div></td></tr></tbody></table></div></div>
<p>But to pass the field values, we need to know their names. If you open the source code or use the Firefox Web Developer Toolbar “Forms &gt; Display Form Details” feature, you will see that the name for the <code>company</code> field is <code>ens_jobeetbundle_jobtype[company]</code>. To make things look a bit more clean, let’s change the format to <code>job[%s]</code> by replacing the <code>getName</code> method with the following code at the end of the <code>JobType</code> class:</p>
<div><div id="highlighter_389964" class="syntaxhighlighter  php"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="php comments">// src/Ens/JobeetBundle/Form/JobType.php</code></div><div class="line number2 index1 alt1"><code class="php comments">// ...</code></div><div class="line number3 index2 alt2">&nbsp;</div><div class="line number4 index3 alt1"><code class="php keyword">public</code> <code class="php keyword">function</code> <code class="php plain">getName()</code></div><div class="line number5 index4 alt2"><code class="php plain">{</code></div><div class="line number6 index5 alt1"><code class="php spaces">&nbsp;&nbsp;</code><code class="php keyword">return</code> <code class="php string">'job'</code><code class="php plain">;</code></div><div class="line number7 index6 alt2"><code class="php plain">}</code></div></div></td></tr></tbody></table></div></div>
<p>After this change, the <code>company</code> name should be <code>job[company]</code> in your browser. It is now time to actually select and pass valid values to the form:</p>
<div><div id="highlighter_534140" class="syntaxhighlighter  php"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1">20</div><div class="line number21 index20 alt2">21</div><div class="line number22 index21 alt1">22</div><div class="line number23 index22 alt2">23</div><div class="line number24 index23 alt1">24</div><div class="line number25 index24 alt2">25</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="php comments">// src/Ens/JobeetBundle/Tests/Controller/JobControllerTest.php</code></div><div class="line number2 index1 alt1"><code class="php comments">// ...</code></div><div class="line number3 index2 alt2">&nbsp;</div><div class="line number4 index3 alt1"><code class="php keyword">public</code> <code class="php keyword">function</code> <code class="php plain">testJobForm()</code></div><div class="line number5 index4 alt2"><code class="php plain">{</code></div><div class="line number6 index5 alt1"><code class="php spaces">&nbsp;&nbsp;</code><code class="php variable">$client</code> <code class="php plain">= </code><code class="php keyword">static</code><code class="php plain">::createClient();</code></div><div class="line number7 index6 alt2">&nbsp;</div><div class="line number8 index7 alt1"><code class="php spaces">&nbsp;&nbsp;</code><code class="php variable">$crawler</code> <code class="php plain">= </code><code class="php variable">$client</code><code class="php plain">-&gt;request(</code><code class="php string">'GET'</code><code class="php plain">, </code><code class="php string">'/job/new'</code><code class="php plain">);</code></div><div class="line number9 index8 alt2"><code class="php spaces">&nbsp;&nbsp;</code><code class="php variable">$this</code><code class="php plain">-&gt;assertEquals(</code><code class="php string">'Ens\JobeetBundle\Controller\JobController::newAction'</code><code class="php plain">, </code><code class="php variable">$client</code><code class="php plain">-&gt;getRequest()-&gt;attributes-&gt;get(</code><code class="php string">'_controller'</code><code class="php plain">));</code></div><div class="line number10 index9 alt1">&nbsp;</div><div class="line number11 index10 alt2"><code class="php spaces">&nbsp;&nbsp;</code><code class="php variable">$form</code> <code class="php plain">= </code><code class="php variable">$crawler</code><code class="php plain">-&gt;selectButton(</code><code class="php string">'Preview your job'</code><code class="php plain">)-&gt;form(</code><code class="php keyword">array</code><code class="php plain">(</code></div><div class="line number12 index11 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php string">'job[company]'</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <code class="php plain">=&gt; </code><code class="php string">'Sensio Labs'</code><code class="php plain">,</code></div><div class="line number13 index12 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php string">'job[url]'</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <code class="php plain">=&gt; </code><code class="php string">'<a href="http://www.sensio.com/">http://www.sensio.com/</a>'</code><code class="php plain">,</code></div><div class="line number14 index13 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php string">'job[file]'</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <code class="php plain">=&gt; __DIR__.</code><code class="php string">'/../../../../../web/bundles/ensjobeet/images/sensio-labs.gif'</code><code class="php plain">,</code></div><div class="line number15 index14 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php string">'job[position]'</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="php plain">=&gt; </code><code class="php string">'Developer'</code><code class="php plain">,</code></div><div class="line number16 index15 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php string">'job[location]'</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="php plain">=&gt; </code><code class="php string">'Atlanta, USA'</code><code class="php plain">,</code></div><div class="line number17 index16 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php string">'job[description]'</code>&nbsp; <code class="php plain">=&gt; </code><code class="php string">'You will work with symfony to develop websites for our customers.'</code><code class="php plain">,</code></div><div class="line number18 index17 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php string">'job[how_to_apply]'</code> <code class="php plain">=&gt; </code><code class="php string">'Send me an email'</code><code class="php plain">,</code></div><div class="line number19 index18 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php string">'job[email]'</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <code class="php plain">=&gt; </code><code class="php string">'for.a.job@example.com'</code><code class="php plain">,</code></div><div class="line number20 index19 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php string">'job[is_public]'</code>&nbsp;&nbsp;&nbsp; <code class="php plain">=&gt; false,</code></div><div class="line number21 index20 alt2"><code class="php spaces">&nbsp;&nbsp;</code><code class="php plain">));</code></div><div class="line number22 index21 alt1">&nbsp;</div><div class="line number23 index22 alt2"><code class="php spaces">&nbsp;&nbsp;</code><code class="php variable">$client</code><code class="php plain">-&gt;submit(</code><code class="php variable">$form</code><code class="php plain">);</code></div><div class="line number24 index23 alt1"><code class="php spaces">&nbsp;&nbsp;</code><code class="php variable">$this</code><code class="php plain">-&gt;assertEquals(</code><code class="php string">'Ens\JobeetBundle\Controller\JobController::createAction'</code><code class="php plain">, </code><code class="php variable">$client</code><code class="php plain">-&gt;getRequest()-&gt;attributes-&gt;get(</code><code class="php string">'_controller'</code><code class="php plain">));</code></div><div class="line number25 index24 alt2"><code class="php plain">}</code></div></div></td></tr></tbody></table></div></div>
<p>The browser also simulates file uploads if you pass the absolute path to the file to upload.</p>
<p>After submitting the form, we checked that the executed action is <code>create</code>.</p>
<h2>Testing the Form</h2>
<p>If the form is valid, the job should have been created and the user redirected to the <code>preview</code> page:</p>
<div><div id="highlighter_861811" class="syntaxhighlighter  php"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="php variable">$client</code><code class="php plain">-&gt;followRedirect();</code></div><div class="line number2 index1 alt1"><code class="php variable">$this</code><code class="php plain">-&gt;assertEquals(</code><code class="php string">'Ens\JobeetBundle\Controller\JobController::previewAction'</code><code class="php plain">, </code><code class="php variable">$client</code><code class="php plain">-&gt;getRequest()-&gt;attributes-&gt;get(</code><code class="php string">'_controller'</code><code class="php plain">));</code></div></div></td></tr></tbody></table></div></div>
<h2>Testing the Database Record</h2>
<p>Eventually, we want to test that the job has been created in the database and check that the <code>is_activated</code> column is set to false as the user has not published it yet.</p>
<div><div id="highlighter_21634" class="syntaxhighlighter  php"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="php variable">$kernel</code> <code class="php plain">= </code><code class="php keyword">static</code><code class="php plain">::createKernel();</code></div><div class="line number2 index1 alt1"><code class="php variable">$kernel</code><code class="php plain">-&gt;boot();</code></div><div class="line number3 index2 alt2"><code class="php variable">$em</code> <code class="php plain">= </code><code class="php variable">$kernel</code><code class="php plain">-&gt;getContainer()-&gt;get(</code><code class="php string">'doctrine.orm.entity_manager'</code><code class="php plain">);</code></div><div class="line number4 index3 alt1">&nbsp;</div><div class="line number5 index4 alt2"><code class="php variable">$query</code> <code class="php plain">= </code><code class="php variable">$em</code><code class="php plain">-&gt;createQuery(</code><code class="php string">'SELECT count(j.id) from EnsJobeetBundle:Job j WHERE j.location = :location AND j.is_activated IS NULL AND j.is_public = 0'</code><code class="php plain">);</code></div><div class="line number6 index5 alt1"><code class="php variable">$query</code><code class="php plain">-&gt;setParameter(</code><code class="php string">'location'</code><code class="php plain">, </code><code class="php string">'Atlanta, USA'</code><code class="php plain">);</code></div><div class="line number7 index6 alt2"><code class="php variable">$this</code><code class="php plain">-&gt;assertTrue(0 &lt; </code><code class="php variable">$query</code><code class="php plain">-&gt;getSingleScalarResult());</code></div></div></td></tr></tbody></table></div></div>
<h2>Testing for Errors</h2>
<p>The job form creation works as expected when we submit valid values. Let’s add a test to check the behavior when we submit non-valid data:</p>
<div><div id="highlighter_288158" class="syntaxhighlighter  php"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="php variable">$crawler</code> <code class="php plain">= </code><code class="php variable">$client</code><code class="php plain">-&gt;request(</code><code class="php string">'GET'</code><code class="php plain">, </code><code class="php string">'/job/new'</code><code class="php plain">);</code></div><div class="line number2 index1 alt1"><code class="php variable">$form</code> <code class="php plain">= </code><code class="php variable">$crawler</code><code class="php plain">-&gt;selectButton(</code><code class="php string">'Preview your job'</code><code class="php plain">)-&gt;form(</code><code class="php keyword">array</code><code class="php plain">(</code></div><div class="line number3 index2 alt2"><code class="php spaces">&nbsp;&nbsp;</code><code class="php string">'job[company]'</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <code class="php plain">=&gt; </code><code class="php string">'Sensio Labs'</code><code class="php plain">,</code></div><div class="line number4 index3 alt1"><code class="php spaces">&nbsp;&nbsp;</code><code class="php string">'job[position]'</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="php plain">=&gt; </code><code class="php string">'Developer'</code><code class="php plain">,</code></div><div class="line number5 index4 alt2"><code class="php spaces">&nbsp;&nbsp;</code><code class="php string">'job[location]'</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="php plain">=&gt; </code><code class="php string">'Atlanta, USA'</code><code class="php plain">,</code></div><div class="line number6 index5 alt1"><code class="php spaces">&nbsp;&nbsp;</code><code class="php string">'job[email]'</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <code class="php plain">=&gt; </code><code class="php string">'not.an.email'</code><code class="php plain">,</code></div><div class="line number7 index6 alt2"><code class="php plain">));</code></div><div class="line number8 index7 alt1"><code class="php variable">$crawler</code> <code class="php plain">= </code><code class="php variable">$client</code><code class="php plain">-&gt;submit(</code><code class="php variable">$form</code><code class="php plain">);</code></div><div class="line number9 index8 alt2">&nbsp;</div><div class="line number10 index9 alt1"><code class="php comments">// check if we have 3 errors</code></div><div class="line number11 index10 alt2"><code class="php variable">$this</code><code class="php plain">-&gt;assertTrue(</code><code class="php variable">$crawler</code><code class="php plain">-&gt;filter(</code><code class="php string">'.error_list'</code><code class="php plain">)-&gt;</code><code class="php functions">count</code><code class="php plain">() == 3);</code></div><div class="line number12 index11 alt1"><code class="php comments">// check if we have error on job_description field</code></div><div class="line number13 index12 alt2"><code class="php variable">$this</code><code class="php plain">-&gt;assertTrue(</code><code class="php variable">$crawler</code><code class="php plain">-&gt;filter(</code><code class="php string">'#job_description'</code><code class="php plain">)-&gt;siblings()-&gt;first()-&gt;filter(</code><code class="php string">'.error_list'</code><code class="php plain">)-&gt;</code><code class="php functions">count</code><code class="php plain">() == 1);</code></div><div class="line number14 index13 alt1"><code class="php comments">// check if we have error on job_how_to_apply field</code></div><div class="line number15 index14 alt2"><code class="php variable">$this</code><code class="php plain">-&gt;assertTrue(</code><code class="php variable">$crawler</code><code class="php plain">-&gt;filter(</code><code class="php string">'#job_how_to_apply'</code><code class="php plain">)-&gt;siblings()-&gt;first()-&gt;filter(</code><code class="php string">'.error_list'</code><code class="php plain">)-&gt;</code><code class="php functions">count</code><code class="php plain">() == 1);</code></div><div class="line number16 index15 alt1"><code class="php comments">// check if we have error on job_email field</code></div><div class="line number17 index16 alt2"><code class="php variable">$this</code><code class="php plain">-&gt;assertTrue(</code><code class="php variable">$crawler</code><code class="php plain">-&gt;filter(</code><code class="php string">'#job_email'</code><code class="php plain">)-&gt;siblings()-&gt;first()-&gt;filter(</code><code class="php string">'.error_list'</code><code class="php plain">)-&gt;</code><code class="php functions">count</code><code class="php plain">() == 1);</code></div></div></td></tr></tbody></table></div></div>
<p>Now, we need to test the admin bar found on the job preview page. When a job has not been activated yet, you can edit, delete, or publish the job. To test those three actions, we will need to first create a job. But that’s a lot of copy and paste, so let’s add a job creator method in the JobControllerTest class:</p>
<div><div id="highlighter_229229" class="syntaxhighlighter  php"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1">20</div><div class="line number21 index20 alt2">21</div><div class="line number22 index21 alt1">22</div><div class="line number23 index22 alt2">23</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="php comments">// src/Ens/JobeetBundle/Tests/Controller/JobControllerTest.php</code></div><div class="line number2 index1 alt1"><code class="php comments">// ...</code></div><div class="line number3 index2 alt2">&nbsp;</div><div class="line number4 index3 alt1"><code class="php keyword">public</code> <code class="php keyword">function</code> <code class="php plain">createJob(</code><code class="php variable">$values</code> <code class="php plain">= </code><code class="php keyword">array</code><code class="php plain">())</code></div><div class="line number5 index4 alt2"><code class="php plain">{</code></div><div class="line number6 index5 alt1"><code class="php spaces">&nbsp;&nbsp;</code><code class="php variable">$client</code> <code class="php plain">= </code><code class="php keyword">static</code><code class="php plain">::createClient();</code></div><div class="line number7 index6 alt2"><code class="php spaces">&nbsp;&nbsp;</code><code class="php variable">$crawler</code> <code class="php plain">= </code><code class="php variable">$client</code><code class="php plain">-&gt;request(</code><code class="php string">'GET'</code><code class="php plain">, </code><code class="php string">'/job/new'</code><code class="php plain">);</code></div><div class="line number8 index7 alt1"><code class="php spaces">&nbsp;&nbsp;</code><code class="php variable">$form</code> <code class="php plain">= </code><code class="php variable">$crawler</code><code class="php plain">-&gt;selectButton(</code><code class="php string">'Preview your job'</code><code class="php plain">)-&gt;form(</code><code class="php functions">array_merge</code><code class="php plain">(</code><code class="php keyword">array</code><code class="php plain">(</code></div><div class="line number9 index8 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php string">'job[company]'</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <code class="php plain">=&gt; </code><code class="php string">'Sensio Labs'</code><code class="php plain">,</code></div><div class="line number10 index9 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php string">'job[url]'</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <code class="php plain">=&gt; </code><code class="php string">'<a href="http://www.sensio.com/">http://www.sensio.com/</a>'</code><code class="php plain">,</code></div><div class="line number11 index10 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php string">'job[position]'</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="php plain">=&gt; </code><code class="php string">'Developer'</code><code class="php plain">,</code></div><div class="line number12 index11 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php string">'job[location]'</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="php plain">=&gt; </code><code class="php string">'Atlanta, USA'</code><code class="php plain">,</code></div><div class="line number13 index12 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php string">'job[description]'</code>&nbsp; <code class="php plain">=&gt; </code><code class="php string">'You will work with symfony to develop websites for our customers.'</code><code class="php plain">,</code></div><div class="line number14 index13 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php string">'job[how_to_apply]'</code> <code class="php plain">=&gt; </code><code class="php string">'Send me an email'</code><code class="php plain">,</code></div><div class="line number15 index14 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php string">'job[email]'</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <code class="php plain">=&gt; </code><code class="php string">'for.a.job@example.com'</code><code class="php plain">,</code></div><div class="line number16 index15 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;</code><code class="php string">'job[is_public]'</code>&nbsp;&nbsp;&nbsp; <code class="php plain">=&gt; false,</code></div><div class="line number17 index16 alt2"><code class="php spaces">&nbsp;&nbsp;</code><code class="php plain">), </code><code class="php variable">$values</code><code class="php plain">));</code></div><div class="line number18 index17 alt1">&nbsp;</div><div class="line number19 index18 alt2"><code class="php spaces">&nbsp;&nbsp;</code><code class="php variable">$client</code><code class="php plain">-&gt;submit(</code><code class="php variable">$form</code><code class="php plain">);</code></div><div class="line number20 index19 alt1"><code class="php spaces">&nbsp;&nbsp;</code><code class="php variable">$client</code><code class="php plain">-&gt;followRedirect();</code></div><div class="line number21 index20 alt2">&nbsp;</div><div class="line number22 index21 alt1"><code class="php spaces">&nbsp;&nbsp;</code><code class="php keyword">return</code> <code class="php variable">$client</code><code class="php plain">;</code></div><div class="line number23 index22 alt2"><code class="php plain">}</code></div></div></td></tr></tbody></table></div></div>
<p>The <code>createJob()</code> method creates a job, follows the redirect and returns the browser. You can also pass an array of values that will be merged with some default values.</p>
<p>Testing the “Publish” action is now more simple:</p>
<div><div id="highlighter_735818" class="syntaxhighlighter  php"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="php comments">// src/Ens/JobeetBundle/Tests/Controller/JobControllerTest.php</code></div><div class="line number2 index1 alt1"><code class="php comments">// ...</code></div><div class="line number3 index2 alt2">&nbsp;</div><div class="line number4 index3 alt1"><code class="php keyword">public</code> <code class="php keyword">function</code> <code class="php plain">testPublishJob()</code></div><div class="line number5 index4 alt2"><code class="php plain">{</code></div><div class="line number6 index5 alt1"><code class="php spaces">&nbsp;&nbsp;</code><code class="php variable">$client</code> <code class="php plain">= </code><code class="php variable">$this</code><code class="php plain">-&gt;createJob(</code><code class="php keyword">array</code><code class="php plain">(</code><code class="php string">'job[position]'</code> <code class="php plain">=&gt; </code><code class="php string">'FOO1'</code><code class="php plain">));</code></div><div class="line number7 index6 alt2"><code class="php spaces">&nbsp;&nbsp;</code><code class="php variable">$crawler</code> <code class="php plain">= </code><code class="php variable">$client</code><code class="php plain">-&gt;getCrawler();</code></div><div class="line number8 index7 alt1"><code class="php spaces">&nbsp;&nbsp;</code><code class="php variable">$form</code> <code class="php plain">= </code><code class="php variable">$crawler</code><code class="php plain">-&gt;selectButton(</code><code class="php string">'Publish'</code><code class="php plain">)-&gt;form();</code></div><div class="line number9 index8 alt2"><code class="php spaces">&nbsp;&nbsp;</code><code class="php variable">$client</code><code class="php plain">-&gt;submit(</code><code class="php variable">$form</code><code class="php plain">);</code></div><div class="line number10 index9 alt1">&nbsp;</div><div class="line number11 index10 alt2"><code class="php spaces">&nbsp;&nbsp;</code><code class="php variable">$kernel</code> <code class="php plain">= </code><code class="php keyword">static</code><code class="php plain">::createKernel();</code></div><div class="line number12 index11 alt1"><code class="php spaces">&nbsp;&nbsp;</code><code class="php variable">$kernel</code><code class="php plain">-&gt;boot();</code></div><div class="line number13 index12 alt2"><code class="php spaces">&nbsp;&nbsp;</code><code class="php variable">$em</code> <code class="php plain">= </code><code class="php variable">$kernel</code><code class="php plain">-&gt;getContainer()-&gt;get(</code><code class="php string">'doctrine.orm.entity_manager'</code><code class="php plain">);</code></div><div class="line number14 index13 alt1">&nbsp;</div><div class="line number15 index14 alt2"><code class="php spaces">&nbsp;&nbsp;</code><code class="php variable">$query</code> <code class="php plain">= </code><code class="php variable">$em</code><code class="php plain">-&gt;createQuery(</code><code class="php string">'SELECT count(j.id) from EnsJobeetBundle:Job j WHERE j.position = :position AND j.is_activated = 1'</code><code class="php plain">);</code></div><div class="line number16 index15 alt1"><code class="php spaces">&nbsp;&nbsp;</code><code class="php variable">$query</code><code class="php plain">-&gt;setParameter(</code><code class="php string">'position'</code><code class="php plain">, </code><code class="php string">'FOO1'</code><code class="php plain">);</code></div><div class="line number17 index16 alt2"><code class="php spaces">&nbsp;&nbsp;</code><code class="php variable">$this</code><code class="php plain">-&gt;assertTrue(0 &lt; </code><code class="php variable">$query</code><code class="php plain">-&gt;getSingleScalarResult());</code></div><div class="line number18 index17 alt1"><code class="php plain">}</code></div></div></td></tr></tbody></table></div></div>
<p>Testing the “Delete” action is quite similar:</p>
<div><div id="highlighter_241000" class="syntaxhighlighter  php"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="php comments">// src/Ens/JobeetBundle/Tests/Controller/JobControllerTest.php</code></div><div class="line number2 index1 alt1"><code class="php comments">// ...</code></div><div class="line number3 index2 alt2">&nbsp;</div><div class="line number4 index3 alt1"><code class="php keyword">public</code> <code class="php keyword">function</code> <code class="php plain">testDeleteJob()</code></div><div class="line number5 index4 alt2"><code class="php plain">{</code></div><div class="line number6 index5 alt1"><code class="php spaces">&nbsp;&nbsp;</code><code class="php variable">$client</code> <code class="php plain">= </code><code class="php variable">$this</code><code class="php plain">-&gt;createJob(</code><code class="php keyword">array</code><code class="php plain">(</code><code class="php string">'job[position]'</code> <code class="php plain">=&gt; </code><code class="php string">'FOO2'</code><code class="php plain">));</code></div><div class="line number7 index6 alt2"><code class="php spaces">&nbsp;&nbsp;</code><code class="php variable">$crawler</code> <code class="php plain">= </code><code class="php variable">$client</code><code class="php plain">-&gt;getCrawler();</code></div><div class="line number8 index7 alt1"><code class="php spaces">&nbsp;&nbsp;</code><code class="php variable">$form</code> <code class="php plain">= </code><code class="php variable">$crawler</code><code class="php plain">-&gt;selectButton(</code><code class="php string">'Delete'</code><code class="php plain">)-&gt;form();</code></div><div class="line number9 index8 alt2"><code class="php spaces">&nbsp;&nbsp;</code><code class="php variable">$client</code><code class="php plain">-&gt;submit(</code><code class="php variable">$form</code><code class="php plain">);</code></div><div class="line number10 index9 alt1">&nbsp;</div><div class="line number11 index10 alt2"><code class="php spaces">&nbsp;&nbsp;</code><code class="php variable">$kernel</code> <code class="php plain">= </code><code class="php keyword">static</code><code class="php plain">::createKernel();</code></div><div class="line number12 index11 alt1"><code class="php spaces">&nbsp;&nbsp;</code><code class="php variable">$kernel</code><code class="php plain">-&gt;boot();</code></div><div class="line number13 index12 alt2"><code class="php spaces">&nbsp;&nbsp;</code><code class="php variable">$em</code> <code class="php plain">= </code><code class="php variable">$kernel</code><code class="php plain">-&gt;getContainer()-&gt;get(</code><code class="php string">'doctrine.orm.entity_manager'</code><code class="php plain">);</code></div><div class="line number14 index13 alt1">&nbsp;</div><div class="line number15 index14 alt2"><code class="php spaces">&nbsp;&nbsp;</code><code class="php variable">$query</code> <code class="php plain">= </code><code class="php variable">$em</code><code class="php plain">-&gt;createQuery(</code><code class="php string">'SELECT count(j.id) from EnsJobeetBundle:Job j WHERE j.position = :position'</code><code class="php plain">);</code></div><div class="line number16 index15 alt1"><code class="php spaces">&nbsp;&nbsp;</code><code class="php variable">$query</code><code class="php plain">-&gt;setParameter(</code><code class="php string">'position'</code><code class="php plain">, </code><code class="php string">'FOO2'</code><code class="php plain">);</code></div><div class="line number17 index16 alt2"><code class="php spaces">&nbsp;&nbsp;</code><code class="php variable">$this</code><code class="php plain">-&gt;assertTrue(0 == </code><code class="php variable">$query</code><code class="php plain">-&gt;getSingleScalarResult());</code></div><div class="line number18 index17 alt1"><code class="php plain">}</code></div></div></td></tr></tbody></table></div></div>
<h2>Tests as a SafeGuard</h2>
<p>When a job is published, you cannot edit it anymore. Even if the “Edit” link is not displayed anymore on the preview page, let’s add some tests for this requirement.</p>
<p>First, add another argument to the <code>createJob()</code> method to allow automatic publication of the job, and create a <code>getJobByPosition()</code> method that returns a job given its position value:</p>
<div><div id="highlighter_903516" class="syntaxhighlighter  php"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1">20</div><div class="line number21 index20 alt2">21</div><div class="line number22 index21 alt1">22</div><div class="line number23 index22 alt2">23</div><div class="line number24 index23 alt1">24</div><div class="line number25 index24 alt2">25</div><div class="line number26 index25 alt1">26</div><div class="line number27 index26 alt2">27</div><div class="line number28 index27 alt1">28</div><div class="line number29 index28 alt2">29</div><div class="line number30 index29 alt1">30</div><div class="line number31 index30 alt2">31</div><div class="line number32 index31 alt1">32</div><div class="line number33 index32 alt2">33</div><div class="line number34 index33 alt1">34</div><div class="line number35 index34 alt2">35</div><div class="line number36 index35 alt1">36</div><div class="line number37 index36 alt2">37</div><div class="line number38 index37 alt1">38</div><div class="line number39 index38 alt2">39</div><div class="line number40 index39 alt1">40</div><div class="line number41 index40 alt2">41</div><div class="line number42 index41 alt1">42</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="php comments">// src/Ens/JobeetBundle/Tests/Controller/JobControllerTest.php</code></div><div class="line number2 index1 alt1"><code class="php comments">// ...</code></div><div class="line number3 index2 alt2">&nbsp;</div><div class="line number4 index3 alt1"><code class="php keyword">public</code> <code class="php keyword">function</code> <code class="php plain">createJob(</code><code class="php variable">$values</code> <code class="php plain">= </code><code class="php keyword">array</code><code class="php plain">(), </code><code class="php variable">$publish</code> <code class="php plain">= false)</code></div><div class="line number5 index4 alt2"><code class="php plain">{</code></div><div class="line number6 index5 alt1"><code class="php spaces">&nbsp;&nbsp;</code><code class="php variable">$client</code> <code class="php plain">= </code><code class="php keyword">static</code><code class="php plain">::createClient();</code></div><div class="line number7 index6 alt2"><code class="php spaces">&nbsp;&nbsp;</code><code class="php variable">$crawler</code> <code class="php plain">= </code><code class="php variable">$client</code><code class="php plain">-&gt;request(</code><code class="php string">'GET'</code><code class="php plain">, </code><code class="php string">'/job/new'</code><code class="php plain">);</code></div><div class="line number8 index7 alt1"><code class="php spaces">&nbsp;&nbsp;</code><code class="php variable">$form</code> <code class="php plain">= </code><code class="php variable">$crawler</code><code class="php plain">-&gt;selectButton(</code><code class="php string">'Preview your job'</code><code class="php plain">)-&gt;form(</code><code class="php functions">array_merge</code><code class="php plain">(</code><code class="php keyword">array</code><code class="php plain">(</code></div><div class="line number9 index8 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php string">'job[company]'</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <code class="php plain">=&gt; </code><code class="php string">'Sensio Labs'</code><code class="php plain">,</code></div><div class="line number10 index9 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php string">'job[url]'</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <code class="php plain">=&gt; </code><code class="php string">'<a href="http://www.sensio.com/">http://www.sensio.com/</a>'</code><code class="php plain">,</code></div><div class="line number11 index10 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php string">'job[position]'</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="php plain">=&gt; </code><code class="php string">'Developer'</code><code class="php plain">,</code></div><div class="line number12 index11 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php string">'job[location]'</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="php plain">=&gt; </code><code class="php string">'Atlanta, USA'</code><code class="php plain">,</code></div><div class="line number13 index12 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php string">'job[description]'</code>&nbsp; <code class="php plain">=&gt; </code><code class="php string">'You will work with symfony to develop websites for our customers.'</code><code class="php plain">,</code></div><div class="line number14 index13 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php string">'job[how_to_apply]'</code> <code class="php plain">=&gt; </code><code class="php string">'Send me an email'</code><code class="php plain">,</code></div><div class="line number15 index14 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php string">'job[email]'</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <code class="php plain">=&gt; </code><code class="php string">'for.a.job@example.com'</code><code class="php plain">,</code></div><div class="line number16 index15 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php string">'job[is_public]'</code>&nbsp;&nbsp;&nbsp; <code class="php plain">=&gt; false,</code></div><div class="line number17 index16 alt2"><code class="php spaces">&nbsp;&nbsp;</code><code class="php plain">), </code><code class="php variable">$values</code><code class="php plain">));</code></div><div class="line number18 index17 alt1">&nbsp;</div><div class="line number19 index18 alt2"><code class="php spaces">&nbsp;&nbsp;</code><code class="php variable">$client</code><code class="php plain">-&gt;submit(</code><code class="php variable">$form</code><code class="php plain">);</code></div><div class="line number20 index19 alt1"><code class="php spaces">&nbsp;&nbsp;</code><code class="php variable">$client</code><code class="php plain">-&gt;followRedirect();</code></div><div class="line number21 index20 alt2">&nbsp;</div><div class="line number22 index21 alt1"><code class="php spaces">&nbsp;&nbsp;</code><code class="php keyword">if</code><code class="php plain">(</code><code class="php variable">$publish</code><code class="php plain">) {</code></div><div class="line number23 index22 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$crawler</code> <code class="php plain">= </code><code class="php variable">$client</code><code class="php plain">-&gt;getCrawler();</code></div><div class="line number24 index23 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$form</code> <code class="php plain">= </code><code class="php variable">$crawler</code><code class="php plain">-&gt;selectButton(</code><code class="php string">'Publish'</code><code class="php plain">)-&gt;form();</code></div><div class="line number25 index24 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$client</code><code class="php plain">-&gt;submit(</code><code class="php variable">$form</code><code class="php plain">);</code></div><div class="line number26 index25 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$client</code><code class="php plain">-&gt;followRedirect();</code></div><div class="line number27 index26 alt2"><code class="php spaces">&nbsp;&nbsp;</code><code class="php plain">}</code></div><div class="line number28 index27 alt1">&nbsp;</div><div class="line number29 index28 alt2"><code class="php spaces">&nbsp;&nbsp;</code><code class="php keyword">return</code> <code class="php variable">$client</code><code class="php plain">;</code></div><div class="line number30 index29 alt1"><code class="php plain">}</code></div><div class="line number31 index30 alt2">&nbsp;</div><div class="line number32 index31 alt1"><code class="php keyword">public</code> <code class="php keyword">function</code> <code class="php plain">getJobByPosition(</code><code class="php variable">$position</code><code class="php plain">)</code></div><div class="line number33 index32 alt2"><code class="php plain">{</code></div><div class="line number34 index33 alt1"><code class="php spaces">&nbsp;&nbsp;</code><code class="php variable">$kernel</code> <code class="php plain">= </code><code class="php keyword">static</code><code class="php plain">::createKernel();</code></div><div class="line number35 index34 alt2"><code class="php spaces">&nbsp;&nbsp;</code><code class="php variable">$kernel</code><code class="php plain">-&gt;boot();</code></div><div class="line number36 index35 alt1"><code class="php spaces">&nbsp;&nbsp;</code><code class="php variable">$em</code> <code class="php plain">= </code><code class="php variable">$kernel</code><code class="php plain">-&gt;getContainer()-&gt;get(</code><code class="php string">'doctrine.orm.entity_manager'</code><code class="php plain">);</code></div><div class="line number37 index36 alt2">&nbsp;</div><div class="line number38 index37 alt1"><code class="php spaces">&nbsp;&nbsp;</code><code class="php variable">$query</code> <code class="php plain">= </code><code class="php variable">$em</code><code class="php plain">-&gt;createQuery(</code><code class="php string">'SELECT j from EnsJobeetBundle:Job j WHERE j.position = :position'</code><code class="php plain">);</code></div><div class="line number39 index38 alt2"><code class="php spaces">&nbsp;&nbsp;</code><code class="php variable">$query</code><code class="php plain">-&gt;setParameter(</code><code class="php string">'position'</code><code class="php plain">, </code><code class="php variable">$position</code><code class="php plain">);</code></div><div class="line number40 index39 alt1"><code class="php spaces">&nbsp;&nbsp;</code><code class="php variable">$query</code><code class="php plain">-&gt;setMaxResults(1);</code></div><div class="line number41 index40 alt2"><code class="php spaces">&nbsp;&nbsp;</code><code class="php keyword">return</code> <code class="php variable">$query</code><code class="php plain">-&gt;getSingleResult();</code></div><div class="line number42 index41 alt1"><code class="php plain">}</code></div></div></td></tr></tbody></table></div></div>
<p>If a job is published, the edit page must return a 404 status code:</p>
<div><div id="highlighter_686622" class="syntaxhighlighter  php"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="php comments">// src/Ens/JobeetBundle/Tests/Controller/JobControllerTest.php</code></div><div class="line number2 index1 alt1"><code class="php comments">// ...</code></div><div class="line number3 index2 alt2">&nbsp;</div><div class="line number4 index3 alt1"><code class="php keyword">public</code> <code class="php keyword">function</code> <code class="php plain">testEditJob()</code></div><div class="line number5 index4 alt2"><code class="php plain">{</code></div><div class="line number6 index5 alt1"><code class="php spaces">&nbsp;&nbsp;</code><code class="php variable">$client</code> <code class="php plain">= </code><code class="php variable">$this</code><code class="php plain">-&gt;createJob(</code><code class="php keyword">array</code><code class="php plain">(</code><code class="php string">'job[position]'</code> <code class="php plain">=&gt; </code><code class="php string">'FOO3'</code><code class="php plain">), true);</code></div><div class="line number7 index6 alt2"><code class="php spaces">&nbsp;&nbsp;</code><code class="php variable">$crawler</code> <code class="php plain">= </code><code class="php variable">$client</code><code class="php plain">-&gt;getCrawler();</code></div><div class="line number8 index7 alt1"><code class="php spaces">&nbsp;&nbsp;</code><code class="php variable">$crawler</code> <code class="php plain">= </code><code class="php variable">$client</code><code class="php plain">-&gt;request(</code><code class="php string">'GET'</code><code class="php plain">, sprintf(</code><code class="php string">'/job/%s/edit'</code><code class="php plain">, </code><code class="php variable">$this</code><code class="php plain">-&gt;getJobByPosition(</code><code class="php string">'FOO3'</code><code class="php plain">)-&gt;getToken()));</code></div><div class="line number9 index8 alt2"><code class="php spaces">&nbsp;&nbsp;</code><code class="php variable">$this</code><code class="php plain">-&gt;assertTrue(404 === </code><code class="php variable">$client</code><code class="php plain">-&gt;getResponse()-&gt;getStatusCode());</code></div><div class="line number10 index9 alt1"><code class="php plain">}</code></div></div></td></tr></tbody></table></div></div>
<p>But if you run the tests, you won’t have the expected result as we forgot to implement this security measure yesterday. Writing tests is also a great way to discover bugs, as you need to think about all edge cases.</p>
<p>Fixing the bug is quite simple as we just need to forward to a 404 page if the job is activated:</p>
<div><div id="highlighter_919120" class="syntaxhighlighter  php"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="php comments">// src/Ens/JobeetBundle/Controller/JobController.php</code></div><div class="line number2 index1 alt1"><code class="php comments">// ...</code></div><div class="line number3 index2 alt2">&nbsp;</div><div class="line number4 index3 alt1"><code class="php keyword">public</code> <code class="php keyword">function</code> <code class="php plain">editAction(</code><code class="php variable">$token</code><code class="php plain">)</code></div><div class="line number5 index4 alt2"><code class="php plain">{</code></div><div class="line number6 index5 alt1"><code class="php spaces">&nbsp;&nbsp;</code><code class="php variable">$em</code> <code class="php plain">= </code><code class="php variable">$this</code><code class="php plain">-&gt;getDoctrine()-&gt;getEntityManager();</code></div><div class="line number7 index6 alt2">&nbsp;</div><div class="line number8 index7 alt1"><code class="php spaces">&nbsp;&nbsp;</code><code class="php variable">$entity</code> <code class="php plain">= </code><code class="php variable">$em</code><code class="php plain">-&gt;getRepository(</code><code class="php string">'EnsJobeetBundle:Job'</code><code class="php plain">)-&gt;findOneByToken(</code><code class="php variable">$token</code><code class="php plain">);</code></div><div class="line number9 index8 alt2">&nbsp;</div><div class="line number10 index9 alt1"><code class="php spaces">&nbsp;&nbsp;</code><code class="php keyword">if</code> <code class="php plain">(!</code><code class="php variable">$entity</code><code class="php plain">) {</code></div><div class="line number11 index10 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php keyword">throw</code> <code class="php variable">$this</code><code class="php plain">-&gt;createNotFoundException(</code><code class="php string">'Unable to find Job entity.'</code><code class="php plain">);</code></div><div class="line number12 index11 alt1"><code class="php spaces">&nbsp;&nbsp;</code><code class="php plain">}</code></div><div class="line number13 index12 alt2">&nbsp;</div><div class="line number14 index13 alt1"><code class="php spaces">&nbsp;&nbsp;</code><code class="php keyword">if</code> <code class="php plain">(</code><code class="php variable">$entity</code><code class="php plain">-&gt;getIsActivated()) {</code></div><div class="line number15 index14 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php keyword">throw</code> <code class="php variable">$this</code><code class="php plain">-&gt;createNotFoundException(</code><code class="php string">'Job is activated and cannot be edited.'</code><code class="php plain">);</code></div><div class="line number16 index15 alt1"><code class="php spaces">&nbsp;&nbsp;</code><code class="php plain">}</code></div><div class="line number17 index16 alt2">&nbsp;</div><div class="line number18 index17 alt1"><code class="php spaces">&nbsp;&nbsp;</code><code class="php comments">// ...</code></div><div class="line number19 index18 alt2"><code class="php plain">}</code></div></div></td></tr></tbody></table></div></div>
<h2>Back to the Future in a Test</h2>
<p>When a job is expiring in less than five days, or if it is already expired, the user can extend the job validation for another 30 days from the current date.</p>
<p>Testing this requirement in a browser is not easy as the expiration date is automatically set when the job is created to 30 days in the future. So, when getting the job page, the link to extend the job is not present. Sure, you can hack the expiration date in the database, or tweak the template to always display the link, but that’s tedious and error prone. As you have already guessed, writing some tests will help us one more time.</p>
<p>As always, we need to add a new route for the <code>extend</code> method first:</p>
<div><div id="highlighter_978007" class="syntaxhighlighter  plain"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="plain plain"># src/Ens/JobeetBundle/Resources/config/routing/job.yml</code></div><div class="line number2 index1 alt1"><code class="plain plain"># ...</code></div><div class="line number3 index2 alt2">&nbsp;</div><div class="line number4 index3 alt1"><code class="plain plain">ens_job_extend:</code></div><div class="line number5 index4 alt2"><code class="plain spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain plain">pattern:&nbsp; /{token}/extend</code></div><div class="line number6 index5 alt1"><code class="plain spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain plain">defaults: { _controller: "EnsJobeetBundle:Job:extend" }</code></div><div class="line number7 index6 alt2"><code class="plain spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain plain">requirements: { _method: post }</code></div></div></td></tr></tbody></table></div></div>
<p>Then, replace the “Extend” link code in the <code>_admin</code> partial with the extend form:</p>
<div><div id="highlighter_605831" class="syntaxhighlighter  xml"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="xml comments">&lt;!-- src/Ens/JobeetBundle/Resources/views/Job/admin.html.twig --&gt;</code></div><div class="line number2 index1 alt1"><code class="xml comments">&lt;!-- ... --&gt;</code></div><div class="line number3 index2 alt2">&nbsp;</div><div class="line number4 index3 alt1"><code class="xml plain">{% if job.expiresSoon %}</code></div><div class="line number5 index4 alt2"><code class="xml spaces">&nbsp;&nbsp;</code><code class="xml plain">&lt;</code><code class="xml keyword">form</code> <code class="xml color1">action</code><code class="xml plain">=</code><code class="xml string">"{{ path('ens_job_extend', { 'token': job.token }) }}"</code> <code class="xml color1">method</code><code class="xml plain">=</code><code class="xml string">"post"</code><code class="xml plain">&gt;</code></div><div class="line number6 index5 alt1"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml plain">{{ form_widget(extend_form) }}</code></div><div class="line number7 index6 alt2"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml plain">&lt;</code><code class="xml keyword">button</code> <code class="xml color1">type</code><code class="xml plain">=</code><code class="xml string">"submit"</code><code class="xml plain">&gt;Extend&lt;/</code><code class="xml keyword">button</code><code class="xml plain">&gt; for another 30 days</code></div><div class="line number8 index7 alt1"><code class="xml spaces">&nbsp;&nbsp;</code><code class="xml plain">&lt;/</code><code class="xml keyword">form</code><code class="xml plain">&gt;</code></div><div class="line number9 index8 alt2"><code class="xml plain">{% endif %}</code></div><div class="line number10 index9 alt1">&nbsp;</div><div class="line number11 index10 alt2"><code class="xml comments">&lt;!-- ... --&gt;</code></div></div></td></tr></tbody></table></div></div>
<p>Then, create the <code>extend</code> action and the extend form:</p>
<div><div id="highlighter_288777" class="syntaxhighlighter  php"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1">20</div><div class="line number21 index20 alt2">21</div><div class="line number22 index21 alt1">22</div><div class="line number23 index22 alt2">23</div><div class="line number24 index23 alt1">24</div><div class="line number25 index24 alt2">25</div><div class="line number26 index25 alt1">26</div><div class="line number27 index26 alt2">27</div><div class="line number28 index27 alt1">28</div><div class="line number29 index28 alt2">29</div><div class="line number30 index29 alt1">30</div><div class="line number31 index30 alt2">31</div><div class="line number32 index31 alt1">32</div><div class="line number33 index32 alt2">33</div><div class="line number34 index33 alt1">34</div><div class="line number35 index34 alt2">35</div><div class="line number36 index35 alt1">36</div><div class="line number37 index36 alt2">37</div><div class="line number38 index37 alt1">38</div><div class="line number39 index38 alt2">39</div><div class="line number40 index39 alt1">40</div><div class="line number41 index40 alt2">41</div><div class="line number42 index41 alt1">42</div><div class="line number43 index42 alt2">43</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="php comments">// src/Ens/JobeetBundle/Controller/JobController.php</code></div><div class="line number2 index1 alt1"><code class="php comments">// ...</code></div><div class="line number3 index2 alt2">&nbsp;</div><div class="line number4 index3 alt1"><code class="php keyword">public</code> <code class="php keyword">function</code> <code class="php plain">extendAction(</code><code class="php variable">$token</code><code class="php plain">)</code></div><div class="line number5 index4 alt2"><code class="php plain">{</code></div><div class="line number6 index5 alt1"><code class="php spaces">&nbsp;&nbsp;</code><code class="php variable">$form</code> <code class="php plain">= </code><code class="php variable">$this</code><code class="php plain">-&gt;createExtendForm(</code><code class="php variable">$token</code><code class="php plain">);</code></div><div class="line number7 index6 alt2"><code class="php spaces">&nbsp;&nbsp;</code><code class="php variable">$request</code> <code class="php plain">= </code><code class="php variable">$this</code><code class="php plain">-&gt;getRequest();</code></div><div class="line number8 index7 alt1">&nbsp;</div><div class="line number9 index8 alt2"><code class="php spaces">&nbsp;&nbsp;</code><code class="php variable">$form</code><code class="php plain">-&gt;bindRequest(</code><code class="php variable">$request</code><code class="php plain">);</code></div><div class="line number10 index9 alt1">&nbsp;</div><div class="line number11 index10 alt2"><code class="php spaces">&nbsp;&nbsp;</code><code class="php keyword">if</code> <code class="php plain">(</code><code class="php variable">$form</code><code class="php plain">-&gt;isValid()) {</code></div><div class="line number12 index11 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$em</code> <code class="php plain">= </code><code class="php variable">$this</code><code class="php plain">-&gt;getDoctrine()-&gt;getEntityManager();</code></div><div class="line number13 index12 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$entity</code> <code class="php plain">= </code><code class="php variable">$em</code><code class="php plain">-&gt;getRepository(</code><code class="php string">'EnsJobeetBundle:Job'</code><code class="php plain">)-&gt;findOneByToken(</code><code class="php variable">$token</code><code class="php plain">);</code></div><div class="line number14 index13 alt1">&nbsp;</div><div class="line number15 index14 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php keyword">if</code> <code class="php plain">(!</code><code class="php variable">$entity</code><code class="php plain">) {</code></div><div class="line number16 index15 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php keyword">throw</code> <code class="php variable">$this</code><code class="php plain">-&gt;createNotFoundException(</code><code class="php string">'Unable to find Job entity.'</code><code class="php plain">);</code></div><div class="line number17 index16 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">}</code></div><div class="line number18 index17 alt1">&nbsp;</div><div class="line number19 index18 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php keyword">if</code> <code class="php plain">(!</code><code class="php variable">$entity</code><code class="php plain">-&gt;extend()) {</code></div><div class="line number20 index19 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php keyword">throw</code> <code class="php variable">$this</code><code class="php plain">-&gt;createNotFoundException(</code><code class="php string">'Unable to find extend the Job.'</code><code class="php plain">);</code></div><div class="line number21 index20 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">}</code></div><div class="line number22 index21 alt1">&nbsp;</div><div class="line number23 index22 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$em</code><code class="php plain">-&gt;persist(</code><code class="php variable">$entity</code><code class="php plain">);</code></div><div class="line number24 index23 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$em</code><code class="php plain">-&gt;</code><code class="php functions">flush</code><code class="php plain">();</code></div><div class="line number25 index24 alt2">&nbsp;</div><div class="line number26 index25 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$this</code><code class="php plain">-&gt;get(</code><code class="php string">'session'</code><code class="php plain">)-&gt;setFlash(</code><code class="php string">'notice'</code><code class="php plain">, sprintf(</code><code class="php string">'Your job validity has been extended until %s.'</code><code class="php plain">, </code><code class="php variable">$entity</code><code class="php plain">-&gt;getExpiresAt()-&gt;format(</code><code class="php string">'m/d/Y'</code><code class="php plain">)));</code></div><div class="line number27 index26 alt2"><code class="php spaces">&nbsp;&nbsp;</code><code class="php plain">}</code></div><div class="line number28 index27 alt1">&nbsp;</div><div class="line number29 index28 alt2"><code class="php spaces">&nbsp;&nbsp;</code><code class="php keyword">return</code> <code class="php variable">$this</code><code class="php plain">-&gt;redirect(</code><code class="php variable">$this</code><code class="php plain">-&gt;generateUrl(</code><code class="php string">'ens_job_preview'</code><code class="php plain">, </code><code class="php keyword">array</code><code class="php plain">(</code></div><div class="line number30 index29 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php string">'company'</code> <code class="php plain">=&gt; </code><code class="php variable">$entity</code><code class="php plain">-&gt;getCompanySlug(),</code></div><div class="line number31 index30 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php string">'location'</code> <code class="php plain">=&gt; </code><code class="php variable">$entity</code><code class="php plain">-&gt;getLocationSlug(),</code></div><div class="line number32 index31 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php string">'token'</code> <code class="php plain">=&gt; </code><code class="php variable">$entity</code><code class="php plain">-&gt;getToken(),</code></div><div class="line number33 index32 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php string">'position'</code> <code class="php plain">=&gt; </code><code class="php variable">$entity</code><code class="php plain">-&gt;getPositionSlug()</code></div><div class="line number34 index33 alt1"><code class="php spaces">&nbsp;&nbsp;</code><code class="php plain">)));</code></div><div class="line number35 index34 alt2"><code class="php plain">}</code></div><div class="line number36 index35 alt1">&nbsp;</div><div class="line number37 index36 alt2"><code class="php keyword">private</code> <code class="php keyword">function</code> <code class="php plain">createExtendForm(</code><code class="php variable">$token</code><code class="php plain">)</code></div><div class="line number38 index37 alt1"><code class="php plain">{</code></div><div class="line number39 index38 alt2"><code class="php spaces">&nbsp;&nbsp;</code><code class="php keyword">return</code> <code class="php variable">$this</code><code class="php plain">-&gt;createFormBuilder(</code><code class="php keyword">array</code><code class="php plain">(</code><code class="php string">'token'</code> <code class="php plain">=&gt; </code><code class="php variable">$token</code><code class="php plain">))</code></div><div class="line number40 index39 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">-&gt;add(</code><code class="php string">'token'</code><code class="php plain">, </code><code class="php string">'hidden'</code><code class="php plain">)</code></div><div class="line number41 index40 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">-&gt;getForm()</code></div><div class="line number42 index41 alt1"><code class="php spaces">&nbsp;&nbsp;</code><code class="php plain">;</code></div><div class="line number43 index42 alt2"><code class="php plain">}</code></div></div></td></tr></tbody></table></div></div>
<p>Also, add the extend form to the <code>preview</code> action:</p>
<div><div id="highlighter_963313" class="syntaxhighlighter  php"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1">20</div><div class="line number21 index20 alt2">21</div><div class="line number22 index21 alt1">22</div><div class="line number23 index22 alt2">23</div><div class="line number24 index23 alt1">24</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="php comments">// src/Ens/JobeetBundle/Controller/JobController.php</code></div><div class="line number2 index1 alt1"><code class="php comments">// ...</code></div><div class="line number3 index2 alt2">&nbsp;</div><div class="line number4 index3 alt1"><code class="php keyword">public</code> <code class="php keyword">function</code> <code class="php plain">previewAction(</code><code class="php variable">$token</code><code class="php plain">)</code></div><div class="line number5 index4 alt2"><code class="php plain">{</code></div><div class="line number6 index5 alt1"><code class="php spaces">&nbsp;&nbsp;</code><code class="php variable">$em</code> <code class="php plain">= </code><code class="php variable">$this</code><code class="php plain">-&gt;getDoctrine()-&gt;getEntityManager();</code></div><div class="line number7 index6 alt2">&nbsp;</div><div class="line number8 index7 alt1"><code class="php spaces">&nbsp;&nbsp;</code><code class="php variable">$entity</code> <code class="php plain">= </code><code class="php variable">$em</code><code class="php plain">-&gt;getRepository(</code><code class="php string">'EnsJobeetBundle:Job'</code><code class="php plain">)-&gt;findOneByToken(</code><code class="php variable">$token</code><code class="php plain">);</code></div><div class="line number9 index8 alt2">&nbsp;</div><div class="line number10 index9 alt1"><code class="php spaces">&nbsp;&nbsp;</code><code class="php keyword">if</code> <code class="php plain">(!</code><code class="php variable">$entity</code><code class="php plain">) {</code></div><div class="line number11 index10 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php keyword">throw</code> <code class="php variable">$this</code><code class="php plain">-&gt;createNotFoundException(</code><code class="php string">'Unable to find Job entity.'</code><code class="php plain">);</code></div><div class="line number12 index11 alt1"><code class="php spaces">&nbsp;&nbsp;</code><code class="php plain">}</code></div><div class="line number13 index12 alt2">&nbsp;</div><div class="line number14 index13 alt1"><code class="php spaces">&nbsp;&nbsp;</code><code class="php variable">$deleteForm</code> <code class="php plain">= </code><code class="php variable">$this</code><code class="php plain">-&gt;createDeleteForm(</code><code class="php variable">$entity</code><code class="php plain">-&gt;getId());</code></div><div class="line number15 index14 alt2"><code class="php spaces">&nbsp;&nbsp;</code><code class="php variable">$publishForm</code> <code class="php plain">= </code><code class="php variable">$this</code><code class="php plain">-&gt;createPublishForm(</code><code class="php variable">$entity</code><code class="php plain">-&gt;getToken());</code></div><div class="line number16 index15 alt1"><code class="php spaces">&nbsp;&nbsp;</code><code class="php variable">$extendForm</code> <code class="php plain">= </code><code class="php variable">$this</code><code class="php plain">-&gt;createExtendForm(</code><code class="php variable">$entity</code><code class="php plain">-&gt;getToken());</code></div><div class="line number17 index16 alt2">&nbsp;</div><div class="line number18 index17 alt1"><code class="php spaces">&nbsp;&nbsp;</code><code class="php keyword">return</code> <code class="php variable">$this</code><code class="php plain">-&gt;render(</code><code class="php string">'EnsJobeetBundle:Job:show.html.twig'</code><code class="php plain">, </code><code class="php keyword">array</code><code class="php plain">(</code></div><div class="line number19 index18 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php string">'entity'</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <code class="php plain">=&gt; </code><code class="php variable">$entity</code><code class="php plain">,</code></div><div class="line number20 index19 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php string">'delete_form'</code> <code class="php plain">=&gt; </code><code class="php variable">$deleteForm</code><code class="php plain">-&gt;createView(),</code></div><div class="line number21 index20 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php string">'publish_form'</code> <code class="php plain">=&gt; </code><code class="php variable">$publishForm</code><code class="php plain">-&gt;createView(),</code></div><div class="line number22 index21 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php string">'extend_form'</code> <code class="php plain">=&gt; </code><code class="php variable">$extendForm</code><code class="php plain">-&gt;createView(),</code></div><div class="line number23 index22 alt2"><code class="php spaces">&nbsp;&nbsp;</code><code class="php plain">));</code></div><div class="line number24 index23 alt1"><code class="php plain">}</code></div></div></td></tr></tbody></table></div></div>
<p>As expected by the action, the <code>extend()</code> method of <code>Job</code> returns <code>true</code> if the job has been extended or <code>false</code> otherwise:</p>
<div><div id="highlighter_922670" class="syntaxhighlighter  php"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="php comments">// src/Ens/Jobeetbundle/Entity/Job.php</code></div><div class="line number2 index1 alt1"><code class="php comments">// ...</code></div><div class="line number3 index2 alt2">&nbsp;</div><div class="line number4 index3 alt1"><code class="php keyword">public</code> <code class="php keyword">function</code> <code class="php plain">extend()</code></div><div class="line number5 index4 alt2"><code class="php plain">{</code></div><div class="line number6 index5 alt1"><code class="php spaces">&nbsp;&nbsp;</code><code class="php keyword">if</code> <code class="php plain">(!</code><code class="php variable">$this</code><code class="php plain">-&gt;expiresSoon())</code></div><div class="line number7 index6 alt2"><code class="php spaces">&nbsp;&nbsp;</code><code class="php plain">{</code></div><div class="line number8 index7 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php keyword">return</code> <code class="php plain">false;</code></div><div class="line number9 index8 alt2"><code class="php spaces">&nbsp;&nbsp;</code><code class="php plain">}</code></div><div class="line number10 index9 alt1">&nbsp;</div><div class="line number11 index10 alt2"><code class="php spaces">&nbsp;&nbsp;</code><code class="php variable">$this</code><code class="php plain">-&gt;expires_at = </code><code class="php keyword">new</code> <code class="php plain">\DateTime(</code><code class="php functions">date</code><code class="php plain">(</code><code class="php string">'Y-m-d H:i:s'</code><code class="php plain">, time() + 86400 * 30));</code></div><div class="line number12 index11 alt1">&nbsp;</div><div class="line number13 index12 alt2"><code class="php spaces">&nbsp;&nbsp;</code><code class="php keyword">return</code> <code class="php plain">true;</code></div><div class="line number14 index13 alt1"><code class="php plain">}</code></div></div></td></tr></tbody></table></div></div>
<p>Eventually, add a test scenario:</p>
<div><div id="highlighter_230218" class="syntaxhighlighter  php"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1">20</div><div class="line number21 index20 alt2">21</div><div class="line number22 index21 alt1">22</div><div class="line number23 index22 alt2">23</div><div class="line number24 index23 alt1">24</div><div class="line number25 index24 alt2">25</div><div class="line number26 index25 alt1">26</div><div class="line number27 index26 alt2">27</div><div class="line number28 index27 alt1">28</div><div class="line number29 index28 alt2">29</div><div class="line number30 index29 alt1">30</div><div class="line number31 index30 alt2">31</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="php comments">// src/Ens/JobeetBundle/Tests/Controller/JobControllerTest.php</code></div><div class="line number2 index1 alt1"><code class="php comments">// ...</code></div><div class="line number3 index2 alt2">&nbsp;</div><div class="line number4 index3 alt1"><code class="php keyword">public</code> <code class="php keyword">function</code> <code class="php plain">testExtendJob()</code></div><div class="line number5 index4 alt2"><code class="php plain">{</code></div><div class="line number6 index5 alt1"><code class="php spaces">&nbsp;&nbsp;</code><code class="php comments">// A job validity cannot be extended before the job expires soon</code></div><div class="line number7 index6 alt2"><code class="php spaces">&nbsp;&nbsp;</code><code class="php variable">$client</code> <code class="php plain">= </code><code class="php variable">$this</code><code class="php plain">-&gt;createJob(</code><code class="php keyword">array</code><code class="php plain">(</code><code class="php string">'job[position]'</code> <code class="php plain">=&gt; </code><code class="php string">'FOO4'</code><code class="php plain">), true);</code></div><div class="line number8 index7 alt1"><code class="php spaces">&nbsp;&nbsp;</code><code class="php variable">$crawler</code> <code class="php plain">= </code><code class="php variable">$client</code><code class="php plain">-&gt;getCrawler();</code></div><div class="line number9 index8 alt2"><code class="php spaces">&nbsp;&nbsp;</code><code class="php variable">$this</code><code class="php plain">-&gt;assertTrue(</code><code class="php variable">$crawler</code><code class="php plain">-&gt;filter(</code><code class="php string">'input[type=submit]:contains("Extend")'</code><code class="php plain">)-&gt;</code><code class="php functions">count</code><code class="php plain">() == 0);</code></div><div class="line number10 index9 alt1">&nbsp;</div><div class="line number11 index10 alt2"><code class="php spaces">&nbsp;&nbsp;</code><code class="php comments">// A job validity can be extended when the job expires soon</code></div><div class="line number12 index11 alt1">&nbsp;</div><div class="line number13 index12 alt2"><code class="php spaces">&nbsp;&nbsp;</code><code class="php comments">// Create a new FOO5 job</code></div><div class="line number14 index13 alt1"><code class="php spaces">&nbsp;&nbsp;</code><code class="php variable">$client</code> <code class="php plain">= </code><code class="php variable">$this</code><code class="php plain">-&gt;createJob(</code><code class="php keyword">array</code><code class="php plain">(</code><code class="php string">'job[position]'</code> <code class="php plain">=&gt; </code><code class="php string">'FOO5'</code><code class="php plain">), true);</code></div><div class="line number15 index14 alt2"><code class="php spaces">&nbsp;&nbsp;</code><code class="php comments">// Get the job and change the expire date to today</code></div><div class="line number16 index15 alt1"><code class="php spaces">&nbsp;&nbsp;</code><code class="php variable">$kernel</code> <code class="php plain">= </code><code class="php keyword">static</code><code class="php plain">::createKernel();</code></div><div class="line number17 index16 alt2"><code class="php spaces">&nbsp;&nbsp;</code><code class="php variable">$kernel</code><code class="php plain">-&gt;boot();</code></div><div class="line number18 index17 alt1"><code class="php spaces">&nbsp;&nbsp;</code><code class="php variable">$em</code> <code class="php plain">= </code><code class="php variable">$kernel</code><code class="php plain">-&gt;getContainer()-&gt;get(</code><code class="php string">'doctrine.orm.entity_manager'</code><code class="php plain">);</code></div><div class="line number19 index18 alt2"><code class="php spaces">&nbsp;&nbsp;</code><code class="php variable">$job</code> <code class="php plain">= </code><code class="php variable">$em</code><code class="php plain">-&gt;getRepository(</code><code class="php string">'EnsJobeetBundle:Job'</code><code class="php plain">)-&gt;findOneByPosition(</code><code class="php string">'FOO5'</code><code class="php plain">);</code></div><div class="line number20 index19 alt1"><code class="php spaces">&nbsp;&nbsp;</code><code class="php variable">$job</code><code class="php plain">-&gt;setExpiresAt(</code><code class="php keyword">new</code> <code class="php plain">\DateTime());</code></div><div class="line number21 index20 alt2"><code class="php spaces">&nbsp;&nbsp;</code><code class="php variable">$em</code><code class="php plain">-&gt;</code><code class="php functions">flush</code><code class="php plain">();</code></div><div class="line number22 index21 alt1"><code class="php spaces">&nbsp;&nbsp;</code><code class="php comments">// Go to the preview page and extend the job</code></div><div class="line number23 index22 alt2"><code class="php spaces">&nbsp;&nbsp;</code><code class="php variable">$crawler</code> <code class="php plain">= </code><code class="php variable">$client</code><code class="php plain">-&gt;request(</code><code class="php string">'GET'</code><code class="php plain">, sprintf(</code><code class="php string">'/job/%s/%s/%s/%s'</code><code class="php plain">, </code><code class="php variable">$job</code><code class="php plain">-&gt;getCompanySlug(), </code><code class="php variable">$job</code><code class="php plain">-&gt;getLocationSlug(), </code><code class="php variable">$job</code><code class="php plain">-&gt;getToken(), </code><code class="php variable">$job</code><code class="php plain">-&gt;getPositionSlug()));</code></div><div class="line number24 index23 alt1"><code class="php spaces">&nbsp;&nbsp;</code><code class="php variable">$crawler</code> <code class="php plain">= </code><code class="php variable">$client</code><code class="php plain">-&gt;getCrawler();</code></div><div class="line number25 index24 alt2"><code class="php spaces">&nbsp;&nbsp;</code><code class="php variable">$form</code> <code class="php plain">= </code><code class="php variable">$crawler</code><code class="php plain">-&gt;selectButton(</code><code class="php string">'Extend'</code><code class="php plain">)-&gt;form();</code></div><div class="line number26 index25 alt1"><code class="php spaces">&nbsp;&nbsp;</code><code class="php variable">$client</code><code class="php plain">-&gt;submit(</code><code class="php variable">$form</code><code class="php plain">);</code></div><div class="line number27 index26 alt2"><code class="php spaces">&nbsp;&nbsp;</code><code class="php comments">// Reload the job from db</code></div><div class="line number28 index27 alt1"><code class="php spaces">&nbsp;&nbsp;</code><code class="php variable">$job</code> <code class="php plain">= </code><code class="php variable">$this</code><code class="php plain">-&gt;getJobByPosition(</code><code class="php string">'FOO5'</code><code class="php plain">);</code></div><div class="line number29 index28 alt2"><code class="php spaces">&nbsp;&nbsp;</code><code class="php comments">// Check the expiration date</code></div><div class="line number30 index29 alt1"><code class="php spaces">&nbsp;&nbsp;</code><code class="php variable">$this</code><code class="php plain">-&gt;assertTrue(</code><code class="php variable">$job</code><code class="php plain">-&gt;getExpiresAt()-&gt;format(</code><code class="php string">'y/m/d'</code><code class="php plain">) == </code><code class="php functions">date</code><code class="php plain">(</code><code class="php string">'y/m/d'</code><code class="php plain">, time() + 86400 * 30));</code></div><div class="line number31 index30 alt2"><code class="php plain">}</code></div></div></td></tr></tbody></table></div></div>
<h2>Maintenance Tasks</h2>
<p>Even if symfony is a web framework, it comes with a command line tool. You have already used it to create the default directory structure of the application bundle and to generate various files for the model. Adding a new command is quite easy.</p>
<p>When a user creates a job, he must activate it to put it online. But if not, the database will grow with stale jobs. Let’s create a command that remove stale jobs from the database. This command will have to be run regularly in a cron job.</p>
<div><div id="highlighter_36270" class="syntaxhighlighter  php"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1">20</div><div class="line number21 index20 alt2">21</div><div class="line number22 index21 alt1">22</div><div class="line number23 index22 alt2">23</div><div class="line number24 index23 alt1">24</div><div class="line number25 index24 alt2">25</div><div class="line number26 index25 alt1">26</div><div class="line number27 index26 alt2">27</div><div class="line number28 index27 alt1">28</div><div class="line number29 index28 alt2">29</div><div class="line number30 index29 alt1">30</div><div class="line number31 index30 alt2">31</div><div class="line number32 index31 alt1">32</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="php comments">// src/Ens/JobeetBundle/Command/JobeetCleanupCommand.php</code></div><div class="line number2 index1 alt1">&nbsp;</div><div class="line number3 index2 alt2"><code class="php keyword">namespace</code> <code class="php plain">Ens\JobeetBundle\Command;</code></div><div class="line number4 index3 alt1">&nbsp;</div><div class="line number5 index4 alt2"><code class="php keyword">use</code> <code class="php plain">Symfony\Bundle\FrameworkBundle\Command\ContainerAwareCommand;</code></div><div class="line number6 index5 alt1"><code class="php keyword">use</code> <code class="php plain">Symfony\Component\Console\Input\InputArgument;</code></div><div class="line number7 index6 alt2"><code class="php keyword">use</code> <code class="php plain">Symfony\Component\Console\Input\InputInterface;</code></div><div class="line number8 index7 alt1"><code class="php keyword">use</code> <code class="php plain">Symfony\Component\Console\Input\InputOption;</code></div><div class="line number9 index8 alt2"><code class="php keyword">use</code> <code class="php plain">Symfony\Component\Console\Output\OutputInterface;</code></div><div class="line number10 index9 alt1"><code class="php keyword">use</code> <code class="php plain">Ens\JobeetBundle\Entity\Job;</code></div><div class="line number11 index10 alt2">&nbsp;</div><div class="line number12 index11 alt1"><code class="php keyword">class</code> <code class="php plain">JobeetCleanupCommand </code><code class="php keyword">extends</code> <code class="php plain">ContainerAwareCommand {</code></div><div class="line number13 index12 alt2">&nbsp;</div><div class="line number14 index13 alt1"><code class="php spaces">&nbsp;&nbsp;</code><code class="php keyword">protected</code> <code class="php keyword">function</code> <code class="php plain">configure()</code></div><div class="line number15 index14 alt2"><code class="php spaces">&nbsp;&nbsp;</code><code class="php plain">{</code></div><div class="line number16 index15 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$this</code></div><div class="line number17 index16 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">-&gt;setName(</code><code class="php string">'ens:jobeet:cleanup'</code><code class="php plain">)</code></div><div class="line number18 index17 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">-&gt;setDescription(</code><code class="php string">'Cleanup Jobeet database'</code><code class="php plain">)</code></div><div class="line number19 index18 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">-&gt;addArgument(</code><code class="php string">'days'</code><code class="php plain">, InputArgument::OPTIONAL, </code><code class="php string">'The email'</code><code class="php plain">, 90)</code></div><div class="line number20 index19 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">;</code></div><div class="line number21 index20 alt2"><code class="php spaces">&nbsp;&nbsp;</code><code class="php plain">}</code></div><div class="line number22 index21 alt1">&nbsp;</div><div class="line number23 index22 alt2"><code class="php spaces">&nbsp;&nbsp;</code><code class="php keyword">protected</code> <code class="php keyword">function</code> <code class="php plain">execute(InputInterface </code><code class="php variable">$input</code><code class="php plain">, OutputInterface </code><code class="php variable">$output</code><code class="php plain">)</code></div><div class="line number24 index23 alt1"><code class="php spaces">&nbsp;&nbsp;</code><code class="php plain">{</code></div><div class="line number25 index24 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$days</code> <code class="php plain">= </code><code class="php variable">$input</code><code class="php plain">-&gt;getArgument(</code><code class="php string">'days'</code><code class="php plain">);</code></div><div class="line number26 index25 alt1">&nbsp;</div><div class="line number27 index26 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$em</code> <code class="php plain">= </code><code class="php variable">$this</code><code class="php plain">-&gt;getContainer()-&gt;get(</code><code class="php string">'doctrine'</code><code class="php plain">)-&gt;getEntityManager();</code></div><div class="line number28 index27 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$nb</code> <code class="php plain">= </code><code class="php variable">$em</code><code class="php plain">-&gt;getRepository(</code><code class="php string">'EnsJobeetBundle:Job'</code><code class="php plain">)-&gt;cleanup(</code><code class="php variable">$days</code><code class="php plain">);</code></div><div class="line number29 index28 alt2">&nbsp;</div><div class="line number30 index29 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$output</code><code class="php plain">-&gt;writeln(sprintf(</code><code class="php string">'Removed %d stale jobs'</code><code class="php plain">, </code><code class="php variable">$nb</code><code class="php plain">));</code></div><div class="line number31 index30 alt2"><code class="php spaces">&nbsp;&nbsp;</code><code class="php plain">}</code></div><div class="line number32 index31 alt1"><code class="php plain">}</code></div></div></td></tr></tbody></table></div></div>
<p>You will have to add the <code>cleanup</code> method to the <code>JobRepository</code> class:</p>
<div><div id="highlighter_479988" class="syntaxhighlighter  php"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="php comments">// src/Ens/JobeetBundle/Repository/JobRepository.php</code></div><div class="line number2 index1 alt1"><code class="php comments">// ...</code></div><div class="line number3 index2 alt2">&nbsp;</div><div class="line number4 index3 alt1"><code class="php keyword">public</code> <code class="php keyword">function</code> <code class="php plain">cleanup(</code><code class="php variable">$days</code><code class="php plain">)</code></div><div class="line number5 index4 alt2"><code class="php plain">{</code></div><div class="line number6 index5 alt1"><code class="php spaces">&nbsp;&nbsp;</code><code class="php variable">$query</code> <code class="php plain">= </code><code class="php variable">$this</code><code class="php plain">-&gt;createQueryBuilder(</code><code class="php string">'j'</code><code class="php plain">)</code></div><div class="line number7 index6 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">-&gt;</code><code class="php functions">delete</code><code class="php plain">()</code></div><div class="line number8 index7 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">-&gt;where(</code><code class="php string">'j.is_activated IS NULL'</code><code class="php plain">)</code></div><div class="line number9 index8 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">-&gt;andWhere(</code><code class="php string">'j.created_at &lt; :created_at'</code><code class="php plain">)&nbsp;&nbsp;&nbsp;&nbsp; -&gt;setParameter(</code><code class="php string">'created_at'</code><code class="php plain">,&nbsp; </code><code class="php functions">date</code><code class="php plain">(</code><code class="php string">'Y-m-d'</code><code class="php plain">, time() - 86400 * </code><code class="php variable">$days</code><code class="php plain">))</code></div><div class="line number10 index9 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">-&gt;getQuery();</code></div><div class="line number11 index10 alt2">&nbsp;</div><div class="line number12 index11 alt1"><code class="php spaces">&nbsp;&nbsp;</code><code class="php keyword">return</code> <code class="php variable">$query</code><code class="php plain">-&gt;execute();</code></div><div class="line number13 index12 alt2"><code class="php plain">}</code></div></div></td></tr></tbody></table></div></div>
<p>To run the command execute the following from the project folder:</p>
<div><div id="highlighter_815888" class="syntaxhighlighter nogutter  plain"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="plain plain">php app/console ens:jobeet:cleanup</code></div></div></td></tr></tbody></table></div></div>
<p>or:</p>
<div><div id="highlighter_467863" class="syntaxhighlighter nogutter  plain"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="plain plain">php app/console ens:jobeet:cleanup 10</code></div></div></td></tr></tbody></table></div></div>
<p>to delete stale jobs older than 10 days.</p>
<p style="float: right;"><a title="Symfony2 Jobeet Day 12: The Admin Bundle" href="http://www.ens.ro/2012/07/13/symfony2-jobeet-day-12-the-admin-bundle/">Symfony2 Jobeet Day 12: The Admin Bundle</a></p>
<p style="float: left;"><a title="Symfony2 Jobeet Day 10: The Forms" href="http://www.ens.ro/2012/05/17/symfony2-jobeet-day-10-the-forms/">Symfony2 Jobeet Day 10: The Forms</a></p>
			</div><!-- .entry-content -->

	<footer class="entry-meta">
		This entry was posted in <a href="http://www.ens.ro/category/english/" title="View all posts in English" rel="category tag">English</a>, <a href="http://www.ens.ro/category/web-development/php/" title="View all posts in PHP" rel="category tag">PHP</a>, <a href="http://www.ens.ro/category/web-development/" title="View all posts in Web Development" rel="category tag">Web Development</a> and tagged <a href="http://www.ens.ro/tag/symfony2-jobeet/" rel="tag">symfony2 jobeet</a> by <a href="http://www.ens.ro/author/dragos/">Dragos Holban</a>. Bookmark the <a href="./Symfony2 Jobeet Day 11  Testing your Forms   ENS_files/Symfony2 Jobeet Day 11  Testing your Forms   ENS.htm" title="Permalink to Symfony2 Jobeet Day 11: Testing your Forms" rel="bookmark">permalink</a>.		
			</footer><!-- .entry-meta -->
</article><!-- #post-1561 -->

						<div id="comments">
	
	
			<h2 id="comments-title">
			5 thoughts on “<span>Symfony2 Jobeet Day 11: Testing your Forms</span>”		</h2>

		
		<ol class="commentlist">
				<li class="comment even thread-even depth-1" id="li-comment-969">
		<article id="comment-969" class="comment">
			<footer class="comment-meta">
				<div class="comment-author vcard">
					<img alt="" src="./Symfony2 Jobeet Day 11  Testing your Forms   ENS_files/7a6c97f1331b8ee210b2e1226ada0190" class="avatar avatar-68 photo" height="68" width="68"><span class="fn">chandi</span> on <a href="http://www.ens.ro/2012/06/22/symfony2-jobeet-day-11-testing-your-forms/#comment-969"><time datetime="2012-07-02T13:29:18+00:00">July 2, 2012 at 1:29 pm</time></a> <span class="says">said:</span>
									</div><!-- .comment-author .vcard -->

				
			</footer>

			<div class="comment-content"><p>Great stuff. Thank you very much for your time.</p>
</div>

			<div class="reply">
				<a class="comment-reply-link" href="http://www.ens.ro/2012/06/22/symfony2-jobeet-day-11-testing-your-forms/?replytocom=969#respond" onclick="return addComment.moveForm(&quot;comment-969&quot;, &quot;969&quot;, &quot;respond&quot;, &quot;1561&quot;)">Reply <span>↓</span></a>			</div><!-- .reply -->
		</article><!-- #comment-## -->

	</li>
	<li class="comment odd alt thread-odd thread-alt depth-1" id="li-comment-1092">
		<article id="comment-1092" class="comment">
			<footer class="comment-meta">
				<div class="comment-author vcard">
					<img alt="" src="./Symfony2 Jobeet Day 11  Testing your Forms   ENS_files/aad438d45945d0c500ad058b81c98b4c" class="avatar avatar-68 photo" height="68" width="68"><span class="fn"><a href="http://www.silvona.com/" onclick="javascript:_gaq.push([&#39;_trackEvent&#39;,&#39;outbound-commentauthor&#39;,&#39;http://www.silvona.com&#39;]);" rel="external nofollow" class="url">Rick Bird</a></span> on <a href="http://www.ens.ro/2012/06/22/symfony2-jobeet-day-11-testing-your-forms/#comment-1092"><time datetime="2012-07-10T08:54:26+00:00">July 10, 2012 at 8:54 am</time></a> <span class="says">said:</span>
									</div><!-- .comment-author .vcard -->

				
			</footer>

			<div class="comment-content"><p>Awesome tutorial series.. Just went through the whole thing, can’t wait for more. <img src="./Symfony2 Jobeet Day 11  Testing your Forms   ENS_files/icon_smile.gif" alt=":)" class="wp-smiley"> </p>
</div>

			<div class="reply">
				<a class="comment-reply-link" href="http://www.ens.ro/2012/06/22/symfony2-jobeet-day-11-testing-your-forms/?replytocom=1092#respond" onclick="return addComment.moveForm(&quot;comment-1092&quot;, &quot;1092&quot;, &quot;respond&quot;, &quot;1561&quot;)">Reply <span>↓</span></a>			</div><!-- .reply -->
		</article><!-- #comment-## -->

	</li>
	<li class="comment even thread-even depth-1" id="li-comment-11391">
		<article id="comment-11391" class="comment">
			<footer class="comment-meta">
				<div class="comment-author vcard">
					<img alt="" src="./Symfony2 Jobeet Day 11  Testing your Forms   ENS_files/0e865c6c0c35980fa2d11f271bf4a580" class="avatar avatar-68 photo" height="68" width="68"><span class="fn">inductor</span> on <a href="http://www.ens.ro/2012/06/22/symfony2-jobeet-day-11-testing-your-forms/#comment-11391"><time datetime="2012-12-21T13:03:37+00:00">December 21, 2012 at 1:03 pm</time></a> <span class="says">said:</span>
									</div><!-- .comment-author .vcard -->

				
			</footer>

			<div class="comment-content"><p>Code from section “Testing for errors” not works for me.<br>
It looks like this works without form validator.<br>
$crawler not gets validated form with errors, but 500 server internal error (try to insert job without required description field).<br>
In web browsers all is ok.<br>
Is it problem with PHPUnit or maybe there is something i miss in configuration?</p>
</div>

			<div class="reply">
				<a class="comment-reply-link" href="http://www.ens.ro/2012/06/22/symfony2-jobeet-day-11-testing-your-forms/?replytocom=11391#respond" onclick="return addComment.moveForm(&quot;comment-11391&quot;, &quot;11391&quot;, &quot;respond&quot;, &quot;1561&quot;)">Reply <span>↓</span></a>			</div><!-- .reply -->
		</article><!-- #comment-## -->

	<ul class="children">
	<li class="comment odd alt depth-2" id="li-comment-24749">
		<article id="comment-24749" class="comment">
			<footer class="comment-meta">
				<div class="comment-author vcard">
					<img alt="" src="./Symfony2 Jobeet Day 11  Testing your Forms   ENS_files/1f3080e43e770fd020455ec8fabbe0dd" class="avatar avatar-39 photo" height="39" width="39"><span class="fn">hmoreau</span> on <a href="http://www.ens.ro/2012/06/22/symfony2-jobeet-day-11-testing-your-forms/#comment-24749"><time datetime="2013-02-27T14:09:47+00:00">February 27, 2013 at 2:09 pm</time></a> <span class="says">said:</span>
									</div><!-- .comment-author .vcard -->

				
			</footer>

			<div class="comment-content"><p>Same thing for me : the “Testing for errors” sectio does not work for me.<br>
It seems that<br>
$form-&gt;isValid()<br>
always retrurns true with PHPUnit<br>
Any suggestion ?</p>
</div>

			<div class="reply">
				<a class="comment-reply-link" href="http://www.ens.ro/2012/06/22/symfony2-jobeet-day-11-testing-your-forms/?replytocom=24749#respond" onclick="return addComment.moveForm(&quot;comment-24749&quot;, &quot;24749&quot;, &quot;respond&quot;, &quot;1561&quot;)">Reply <span>↓</span></a>			</div><!-- .reply -->
		</article><!-- #comment-## -->

	<ul class="children">
	<li class="comment even depth-3" id="li-comment-34091">
		<article id="comment-34091" class="comment">
			<footer class="comment-meta">
				<div class="comment-author vcard">
					<img alt="" src="./Symfony2 Jobeet Day 11  Testing your Forms   ENS_files/1bfe6de76ff0e2106d55d565fa67fb42" class="avatar avatar-39 photo" height="39" width="39"><span class="fn">murty</span> on <a href="http://www.ens.ro/2012/06/22/symfony2-jobeet-day-11-testing-your-forms/#comment-34091"><time datetime="2013-03-28T18:33:22+00:00">March 28, 2013 at 6:33 pm</time></a> <span class="says">said:</span>
									</div><!-- .comment-author .vcard -->

				
			</footer>

			<div class="comment-content"><p>I encountered the same problem and little bit of research on StackOverflow helped to identify the problem. We need to enable the validation in config.yml:</p>
<p>    validation:      { enabled: true, enable_annotations: true }</p>
<p>here is the SO link <a href="http://stackoverflow.com/questions/12601104/yml-validation-file-is-ignored" onclick="javascript:_gaq.push([&#39;_trackEvent&#39;,&#39;outbound-comment&#39;,&#39;http://stackoverflow.com&#39;]);" rel="nofollow">http://stackoverflow.com/questions/12601104/yml-validation-file-is-ignored</a></p>
</div>

			<div class="reply">
				<a class="comment-reply-link" href="http://www.ens.ro/2012/06/22/symfony2-jobeet-day-11-testing-your-forms/?replytocom=34091#respond" onclick="return addComment.moveForm(&quot;comment-34091&quot;, &quot;34091&quot;, &quot;respond&quot;, &quot;1561&quot;)">Reply <span>↓</span></a>			</div><!-- .reply -->
		</article><!-- #comment-## -->

	</li>
</ul>
</li>
</ul>
</li>
		</ol>

		
		
	
									<div id="respond">
				<h3 id="reply-title">Leave a Reply <small><a rel="nofollow" id="cancel-comment-reply-link" href="http://www.ens.ro/2012/06/22/symfony2-jobeet-day-11-testing-your-forms/#respond" style="display:none;">Cancel reply</a></small></h3>
									<form action="http://www.ens.ro/wp-comments-post.php" method="post" id="commentform">
																			<p class="comment-notes">Your email address will not be published. Required fields are marked <span class="required">*</span></p>							<p class="comment-form-author"><label for="author">Name <span class="required">*</span></label> <input id="author" name="author" type="text" value="" size="30" aria-required="true"></p>
<p class="comment-form-email"><label for="email">Email <span class="required">*</span></label> <input id="email" name="email" type="text" value="" size="30" aria-required="true"></p>
<p class="comment-form-url"><label for="url">Website</label><input id="url" name="url" type="text" value="" size="30"></p>
												<p class="comment-form-comment"><label for="comment">Comment</label><textarea id="comment" name="comment" cols="45" rows="8" aria-required="true"></textarea></p>						<p class="form-allowed-tags">You may use these <abbr title="HyperText Markup Language">HTML</abbr> tags and attributes:  <code>&lt;a href="" title=""&gt; &lt;abbr title=""&gt; &lt;acronym title=""&gt; &lt;b&gt; &lt;blockquote cite=""&gt; &lt;cite&gt; &lt;code&gt; &lt;del datetime=""&gt; &lt;em&gt; &lt;i&gt; &lt;q cite=""&gt; &lt;strike&gt; &lt;strong&gt; </code></p>						<p class="form-submit">
							<input name="submit" type="submit" id="submit" value="Post Comment">
							<input type="hidden" name="comment_post_ID" value="1561" id="comment_post_ID">
<input type="hidden" name="comment_parent" id="comment_parent" value="0">
						</p>
						<p style="display: none;"><input type="hidden" id="akismet_comment_nonce" name="akismet_comment_nonce" value="88ad6eea9e"></p>					</form>
							</div><!-- #respond -->
				<script type="text/javascript">
		jQuery(document).ready(function () {
			jQuery('#commentform').submit(function () {
				_gaq.push(
					['_setAccount', 'UA-29990339-1'],
					['_trackEvent', 'comment', 'submit']
				);
			});
		});
	</script>
				
</div><!-- #comments -->

				
			</div><!-- #content -->
		</div><!-- #primary -->


	</div><!-- #main -->

	<footer id="colophon" role="contentinfo">

			

			<div id="site-generator">
								<a href="http://wordpress.org/" title="Semantic Personal Publishing Platform">Proudly powered by WordPress</a>
			</div>
	</footer><!-- #colophon -->
</div><!-- #page -->

<div id="dcssb-slick" class="dc-social-slick vertical right align-top" style="float: none; position: fixed; z-index: 10000; margin-right: -100px; top: 50px;"><div class="tab" style="position: absolute; margin-left: -46px;"><span><img src="./Symfony2 Jobeet Day 11  Testing your Forms   ENS_files/tab_right_vertical.png" alt="Share"></span></div><div id="dc-dcssb" class="dc-social-slick-content" style="height: 210px;">
		<ul id="nav-dcssb" class=""><li id="dcssb-twitter" class="size-box"><iframe id="twitter-widget-0" scrolling="no" frameborder="0" allowtransparency="true" src="./Symfony2 Jobeet Day 11  Testing your Forms   ENS_files/tweet_button.1386967771.htm" class="twitter-share-button twitter-tweet-button twitter-count-vertical" title="Twitter Tweet Button" data-twttr-rendered="true" style="width: 59px; height: 62px;"></iframe></li>
			
			<div id="fb-root" class=" fb_reset"><div style="position: absolute; top: -10000px; height: 0px; width: 0px;"><div></div></div><div style="position: absolute; top: -10000px; height: 0px; width: 0px;"><div><iframe name="fb_xdm_frame_http" frameborder="0" allowtransparency="true" scrolling="no" id="fb_xdm_frame_http" aria-hidden="true" title="Facebook Cross Domain Communication Frame" tab-index="-1" src="./Symfony2 Jobeet Day 11  Testing your Forms   ENS_files/xd_arbiter.htm" style="border: none;"></iframe><iframe name="fb_xdm_frame_https" frameborder="0" allowtransparency="true" scrolling="no" id="fb_xdm_frame_https" aria-hidden="true" title="Facebook Cross Domain Communication Frame" tab-index="-1" src="./Symfony2 Jobeet Day 11  Testing your Forms   ENS_files/xd_arbiter(1).htm" style="border: none;"></iframe></div></div><script type="text/javascript" src="./Symfony2 Jobeet Day 11  Testing your Forms   ENS_files/all.js" async=""></script></div>
			
<li id="dcssb-facebook" class="size-box"><fb:like href="http%3A%2F%2Fwww.ens.ro%2F2012%2F06%2F22%2Fsymfony2-jobeet-day-11-testing-your-forms%2F" send="false" layout="box_count" show_faces="false" font="" fb-xfbml-state="rendered" class=" fb_edge_widget_with_comment fb_iframe_widget"><span style="height: 65px; width: 55px;"><iframe id="f3c333d9f" name="f1a0e33e3" scrolling="no" title="Like this content on Facebook." class="fb_ltr" src="./Symfony2 Jobeet Day 11  Testing your Forms   ENS_files/like.htm" style="border: none; overflow: hidden; height: 65px; width: 55px;"></iframe></span></fb:like></li>
			<li id="dcssb-plusone" class="size-box"><div id="___plusone_0" style="text-indent: 0px; margin: 0px; padding: 0px; background-color: transparent; border-style: none; float: none; line-height: normal; font-size: 1px; vertical-align: baseline; display: inline-block; width: 50px; height: 60px; background-position: initial initial; background-repeat: initial initial;"><iframe frameborder="0" hspace="0" marginheight="0" marginwidth="0" scrolling="no" style="position: static; top: 0px; width: 50px; margin: 0px; border-style: none; left: 0px; visibility: visible; height: 60px;" tabindex="0" vspace="0" width="100%" id="I0_1387031757652" name="I0_1387031757652" src="./Symfony2 Jobeet Day 11  Testing your Forms   ENS_files/fastbutton.htm" data-gapiattached="true" title="+1"></iframe></div></li>
			
				</ul>
		<div class="clear"></div>
		<div class="dc-corner"><span></span></div>
		</div></div>			<script type="text/javascript">_ga.trackFacebook();</script>
			<script type="text/javascript">
				jQuery(window).load(function() {

								
					var config = {
						idWrapper : 'dcssb-slick',
						location: 'right',
						align: 'top',
						offset: '50px',
						speed: 600,
						tabText: '<img src="http://www.ens.ro/wp-content/plugins/slick-social-share-buttons/css/images/tab_right_vertical.png" alt="Share" />',
						autoClose: true,
						loadOpen: false,
						classWrapper: 'dc-social-slick vertical',
						classOpen: 'dcssb-open',
						classClose: 'dcssb-close',
						classToggle: 'dcssb-link'					
					};
					if(!jQuery().dcSocialSlick) {
						jQuery.getScript('http://www.ens.ro/wp-content/plugins/slick-social-share-buttons/js/jquery.social.slick.1.0.js', function(){
							jQuery('#dc-dcssb').dcSocialSlick(config);
						}); 
					} else {
						jQuery('#dc-dcssb').dcSocialSlick(config);
					}

								});
			</script>
		
			<script type="text/javascript" src="./Symfony2 Jobeet Day 11  Testing your Forms   ENS_files/shCore.js"></script>
<script type="text/javascript" src="./Symfony2 Jobeet Day 11  Testing your Forms   ENS_files/shBrushPhp.js"></script>
<script type="text/javascript" src="./Symfony2 Jobeet Day 11  Testing your Forms   ENS_files/shBrushPlain.js"></script>
<script type="text/javascript" src="./Symfony2 Jobeet Day 11  Testing your Forms   ENS_files/shBrushXml.js"></script>
<script type="text/javascript">
	(function(){
		var corecss = document.createElement('link');
		var themecss = document.createElement('link');
		var corecssurl = "http://www.ens.ro/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/styles/shCore.css?ver=3.0.83c";
		if ( corecss.setAttribute ) {
				corecss.setAttribute( "rel", "stylesheet" );
				corecss.setAttribute( "type", "text/css" );
				corecss.setAttribute( "href", corecssurl );
		} else {
				corecss.rel = "stylesheet";
				corecss.href = corecssurl;
		}
		document.getElementsByTagName("head")[0].insertBefore( corecss, document.getElementById("syntaxhighlighteranchor") );
		var themecssurl = "http://www.ens.ro/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/styles/shThemeDefault.css?ver=3.0.83c";
		if ( themecss.setAttribute ) {
				themecss.setAttribute( "rel", "stylesheet" );
				themecss.setAttribute( "type", "text/css" );
				themecss.setAttribute( "href", themecssurl );
		} else {
				themecss.rel = "stylesheet";
				themecss.href = themecssurl;
		}
		//document.getElementById("syntaxhighlighteranchor").appendChild(themecss);
		document.getElementsByTagName("head")[0].insertBefore( themecss, document.getElementById("syntaxhighlighteranchor") );
	})();
	SyntaxHighlighter.config.strings.expandSource = '+ expand source';
	SyntaxHighlighter.config.strings.help = '?';
	SyntaxHighlighter.config.strings.alert = 'SyntaxHighlighter\n\n';
	SyntaxHighlighter.config.strings.noBrush = 'Can\'t find brush for: ';
	SyntaxHighlighter.config.strings.brushNotHtmlScript = 'Brush wasn\'t configured for html-script option: ';
	SyntaxHighlighter.defaults['pad-line-numbers'] = false;
	SyntaxHighlighter.defaults['tab-size'] = 2;
	SyntaxHighlighter.defaults['toolbar'] = false;
	SyntaxHighlighter.all();
</script>
<script type="text/javascript" src="./Symfony2 Jobeet Day 11  Testing your Forms   ENS_files/jquery.form.min.js"></script>
<script type="text/javascript">
/* <![CDATA[ */
var _wpcf7 = {"loaderUrl":"http:\/\/www.ens.ro\/wp-content\/plugins\/contact-form-7\/images\/ajax-loader.gif","sending":"Sending ..."};
/* ]]> */
</script>
<script type="text/javascript" src="./Symfony2 Jobeet Day 11  Testing your Forms   ENS_files/scripts.js"></script>


<iframe name="oauth2relay662907288" id="oauth2relay662907288" src="./Symfony2 Jobeet Day 11  Testing your Forms   ENS_files/postmessageRelay.htm" style="width: 1px; height: 1px; position: absolute; top: -100px;"></iframe></body></html>